2026-01-06 15:06:25,804 - INFO - [LLM registry a9d08a37-bedc-4b1e-ad16-037606cd1b4a]: Registering service for agent
2026-01-06 15:06:25,848 - INFO - Building image: ghcr.io/openhands/runtime:oh_v1.0.0_htl7m5g9uzfck0wn_v008aov5t6vw3gr5
2026-01-06 15:16:51,441 - INFO - Image [ghcr.io/openhands/runtime:oh_v1.0.0_htl7m5g9uzfck0wn_v008aov5t6vw3gr5] build finished.
2026-01-06 15:16:51,448 - INFO - Re-tagged image [ghcr.io/openhands/runtime:oh_v1.0.0_htl7m5g9uzfck0wn_v008aov5t6vw3gr5] with more generic tag [oh_v1.0.0_htl7m5g9uzfck0wn]
2026-01-06 15:16:51,449 - INFO - Image ghcr.io/openhands/runtime with tags [oh_v1.0.0_htl7m5g9uzfck0wn_v008aov5t6vw3gr5, oh_v1.0.0_htl7m5g9uzfck0wn] built successfully
2026-01-06 15:16:51,481 - INFO - [runtime de371d4e-6e84-4e-dd8dda8a5562c20] Starting runtime with image: ghcr.io/openhands/runtime:oh_v1.0.0_htl7m5g9uzfck0wn_v008aov5t6vw3gr5
2026-01-06 15:16:51,715 - INFO - [runtime de371d4e-6e84-4e-dd8dda8a5562c20] Starting server with command: ['/openhands/micromamba/bin/micromamba', 'run', '-n', 'openhands', 'poetry', 'run', 'python', '-u', '-m', 'openhands.runtime.action_execution_server', '39492', '--working-dir', '/workspace', '--plugins', 'agent_skills', 'jupyter', '--username', 'root', '--user-id', '0', '--no-enable-browser']
2026-01-06 15:16:52,073 - INFO - [runtime de371d4e-6e84-4e-dd8dda8a5562c20] Container started: openhands-runtime-de371d4e-6e84-4e-dd8dda8a5562c20. VSCode URL: None
2026-01-06 15:16:52,073 - INFO - [runtime de371d4e-6e84-4e-dd8dda8a5562c20] Waiting for client to become ready at http://localhost:39492...
2026-01-06 15:17:22,263 - INFO - [runtime de371d4e-6e84-4e-dd8dda8a5562c20] Runtime is ready.
2026-01-06 15:17:25,388 - INFO - Successfully configured git: name=openhands, email=openhands@all-hands.dev
2026-01-06 15:17:25,390 - INFO - ------------------------------
2026-01-06 15:17:25,390 - INFO - BEGIN Runtime Initialization Fn
2026-01-06 15:17:25,390 - INFO - ------------------------------
2026-01-06 15:17:25,390 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
echo 'export SWE_INSTANCE_ID=django__django-15388' >> ~/.bashrc && echo 'export PIP_CACHE_DIR=~/.cache/pip' >> ~/.bashrc && echo "alias git='git --no-pager'" >> ~/.bashrc && git config --global core.pager "" && git config --global diff.binary false
2026-01-06 15:17:26,010 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:17:26,011 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
export USER=$(whoami); echo USER=${USER} 
2026-01-06 15:17:26,630 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
USER=root
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:17:26,631 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
mkdir -p /swe_util/eval_data/instances
2026-01-06 15:17:27,250 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:17:27,257 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cat ~/.bashrc
2026-01-06 15:17:27,877 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
source /opt/miniconda3/etc/profile.d/conda.sh && conda activate testbed

. "/openhands/bin/env"
export PATH="/usr/bin:/bin:/usr/sbin:/sbin:/openhands/micromamba/bin:$PATH"
export PLAYWRIGHT_BROWSERS_PATH=/opt/playwright-browsers
eval "$(/openhands/micromamba/bin/micromamba shell hook --shell bash)"
micromamba activate openhands 2>/dev/null || true
export ENABLE_AUTO_LINT=true
export NO_CHANGE_TIMEOUT_SECONDS=30
export OPENHANDS_EVAL_INSTANCE_ID=django__django-15388
export OPENHANDS_EVAL_JOB_ID=2732283895
export OPENHANDS_TIMING_DIR=./continuum32/princeton-nlp__SWE-bench_Lite-test/CodeActAgent/GLM-4.6-FP8_maxiter_135/timing
export SWE_INSTANCE_ID=django__django-15388
export PIP_CACHE_DIR=~/.cache/pip
alias git='git --no-pager'
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:17:27,879 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
source ~/.bashrc
2026-01-06 15:17:28,499 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:17:28,499 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
source /swe_util/instance_swe_entry.sh
2026-01-06 15:17:30,123 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
WORKSPACE_NAME: django__django__4.1
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:17:30,123 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cd /workspace/django__django__4.1
2026-01-06 15:17:30,743 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace/django__django__4.1",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__4.1]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:17:30,743 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git reset --hard
2026-01-06 15:17:32,367 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace/django__django__4.1",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
Updating files: 100% (6603/6603), done.
HEAD is now at c5cd878382 Refs #33476 -- Refactored problematic code before reformatting by Black.
[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__4.1]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:17:32,368 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
for remote_name in $(git remote); do git remote remove "${remote_name}"; done
2026-01-06 15:17:32,987 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace/django__django__4.1",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__4.1]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:17:32,987 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
which python
2026-01-06 15:17:33,634 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace/django__django__4.1",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
/opt/miniconda3/envs/testbed/bin/python
[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__4.1]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:17:33,640 - INFO - ------------------------------
2026-01-06 15:17:33,640 - INFO - END Runtime Initialization Fn
2026-01-06 15:17:33,640 - INFO - ------------------------------
2026-01-06 15:17:33,643 - INFO - [LLM registry 2fa3e387-f6de-4e06-95f9-0040a95ffeaa]: Registering service for agent
2026-01-06 15:17:33,657 - INFO - [runtime de371d4e-6e84-4e-dd8dda8a5562c20] Selected repo: None, loading microagents from /workspace/.openhands/microagents (inside runtime)
2026-01-06 15:17:33,660 - INFO - [runtime de371d4e-6e84-4e-dd8dda8a5562c20] Attempting to list files in repository microagents directory: /workspace/.openhands/microagents
2026-01-06 15:17:33,662 - INFO - Loading user workspace microagents: []
2026-01-06 15:17:33,662 - INFO - AgentController de371d4e-6e84-4e-dd8dda8a5562c20 - created new state. start_id: 0
2026-01-06 15:17:33,670 - INFO - [Agent Controller de371d4e-6e84-4e-dd8dda8a5562c20] Setting agent(CodeActAgent) state from AgentState.LOADING to AgentState.RUNNING
2026-01-06 15:17:33,678 - INFO - Saved conversation stats
2026-01-06 15:32:14,215 - WARNING - Action, Observation loop detected
2026-01-06 15:32:14,216 - ERROR - AgentStuckInLoopError: Agent got stuck in a loop
2026-01-06 15:32:14,216 - INFO - [Agent Controller de371d4e-6e84-4e-dd8dda8a5562c20] Setting agent(CodeActAgent) state from AgentState.RUNNING to AgentState.ERROR
2026-01-06 15:32:14,218 - INFO - Saved conversation stats
2026-01-06 15:32:14,218 - INFO - [Agent Controller de371d4e-6e84-4e-dd8dda8a5562c20] Setting agent(CodeActAgent) state from AgentState.ERROR to AgentState.ERROR
2026-01-06 15:32:14,869 - INFO - ------------------------------
2026-01-06 15:32:14,869 - INFO - BEGIN Runtime Completion Fn
2026-01-06 15:32:14,869 - INFO - ------------------------------
2026-01-06 15:32:14,870 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cd /workspace/django__django__4.1
2026-01-06 15:32:15,487 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace/django__django__4.1",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__4.1]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:15,487 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git config --global core.pager ""
2026-01-06 15:32:16,105 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace/django__django__4.1",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__4.1]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:16,105 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
find . -type d -name .git -not -path "./.git"
2026-01-06 15:32:16,724 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace/django__django__4.1",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__4.1]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:16,724 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git add -A
2026-01-06 15:32:17,342 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace/django__django__4.1",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__4.1]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:17,342 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
for file in $(git status --porcelain | grep -E "^(M| M|\?\?|A| A)" | cut -c4-); do
        if [ -f "$file" ] && (file "$file" | grep -q "executable" || git check-attr binary "$file" | grep -q "binary: set"); then
            git rm -f "$file" 2>/dev/null || rm -f "$file"
            echo "Removed: $file"
        fi
    done
2026-01-06 15:32:17,970 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace/django__django__4.1",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
bash: file: command not found
bash: file: command not found
bash: file: command not found
bash: file: command not found
bash: file: command not found
bash: file: command not found
bash: file: command not found
bash: file: command not found
bash: file: command not found
bash: file: command not found
[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__4.1]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:17,971 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git diff --no-color --cached c5cd8783825b5f6384417dac5f3889b4210b7d08 > patch.diff
2026-01-06 15:32:18,590 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "7adebb5529ff",
  "working_dir": "/workspace/django__django__4.1",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__4.1]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:18,591 - INFO - FileReadAction(path='patch.diff', start=0, end=-1, thought='', action=<ActionType.READ: 'read'>, security_risk=<ActionSecurityRisk.UNKNOWN: -1>, impl_source=<FileReadSource.DEFAULT: 'default'>, view_range=None)
2026-01-06 15:32:18,594 - INFO - [Read from /workspace/django__django__4.1/patch.diff is successful.]
diff --git a/debug_autoreload.py b/debug_autoreload.py
new file mode 100644
index 0000000000..c09e157a4d
--- /dev/null
+++ b/debug_autoreload.py
@@ -0,0 +1,121 @@
+#!/usr/bin/env python
+"""
+Debug the autoreload mechanism to see where the issue really is.
+"""
+import os
+import sys
+import tempfile
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def debug_autoreload():
+    """Debug the autoreload mechanism."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating project in: {project_path}")
+    
+    # Create project structure
+    project_path.mkdir(parents=True)
+    (project_path / '__init__.py').touch()
+    
+    # Create settings.py with BASE_DIR in TEMPLATES DIRS
+    settings_content = f'''
+import os
+from pathlib import Path
+
+BASE_DIR = Path(__file__).resolve().parent.parent
+SECRET_KEY = 'django-insecure-test-key'
+DEBUG = True
+ALLOWED_HOSTS = []
+INSTALLED_APPS = [
+    'django.contrib.contenttypes',
+    'django.contrib.auth',
+]
+ROOT_URLCONF = 'testproject.urls'
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [BASE_DIR],  # BASE_DIR in DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.request',
+            ],
+        }},
+    }},
+]
+USE_TZ = True
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    (project_path / 'urls.py').write_text('from django.urls import path\nurlpatterns = []')
+    
+    try:
+        # Set up environment
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        import django
+        django.setup()
+        
+        from django.template.autoreload import get_template_directories, watch_for_template_changes
+        from django.utils.autoreload import BaseReloader
+        from unittest.mock import MagicMock
+        
+        print(f"\n=== Testing get_template_directories() ===")
+        template_dirs = get_template_directories()
+        print(f"Template directories: {template_dirs}")
+        
+        from django.conf import settings
+        base_dir = Path(settings.BASE_DIR)
+        print(f"BASE_DIR: {base_dir}")
+        print(f"BASE_DIR in template_dirs: {base_dir in template_dirs}")
+        
+        print(f"\n=== Testing watch_for_template_changes() ===")
+        mock_reloader = MagicMock()
+        watch_for_template_changes(mock_reloader)
+        
+        print(f"watch_dir calls:")
+        for call in mock_reloader.watch_dir.call_args_list:
+            print(f"  {call}")
+        
+        print(f"\n=== Testing file change detection ===")
+        # Create a test file in BASE_DIR
+        test_file = base_dir / 'test_template.html'
+        test_file.write_text('<html><body>Test</body></html>')
+        print(f"Created test file: {test_file}")
+        
+        # Test if the file would be detected as changed
+        from django.template.autoreload import template_changed
+        result = template_changed(None, test_file)
+        print(f"template_changed result: {result}")
+        
+        # Test the file watching logic
+        print(f"\n=== Testing file watching logic ===")
+        for template_dir in template_dirs:
+            print(f"Template dir: {template_dir}")
+            print(f"  test_file parents: {test_file.parents}")
+            print(f"  template_dir in test_file.parents: {template_dir in test_file.parents}")
+        
+    finally:
+        import shutil
+        shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    debug_autoreload()
diff --git a/debug_detailed.py b/debug_detailed.py
new file mode 100644
index 0000000000..4309e67bbc
--- /dev/null
+++ b/debug_detailed.py
@@ -0,0 +1,140 @@
+#!/usr/bin/env python
+"""
+Detailed debug of the BASE_DIR in TEMPLATES DIRS issue.
+"""
+import os
+import sys
+import tempfile
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def debug_detailed():
+    """Debug the issue in detail."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating project in: {project_path}")
+    
+    # Create project structure
+    project_path.mkdir(parents=True)
+    (project_path / '__init__.py').touch()
+    
+    # Create settings.py with BASE_DIR in TEMPLATES DIRS
+    settings_content = f'''
+import os
+from pathlib import Path
+
+BASE_DIR = Path(__file__).resolve().parent.parent
+SECRET_KEY = 'django-insecure-test-key'
+DEBUG = True
+ALLOWED_HOSTS = []
+INSTALLED_APPS = [
+    'django.contrib.contenttypes',
+    'django.contrib.auth',
+]
+ROOT_URLCONF = 'testproject.urls'
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [BASE_DIR],  # BASE_DIR in DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.request',
+            ],
+        }},
+    }},
+]
+USE_TZ = True
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    (project_path / 'urls.py').write_text('from django.urls import path\nurlpatterns = []')
+    
+    try:
+        # Set up environment
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        import django
+        django.setup()
+        
+        from django.conf import settings
+        from django.template import engines
+        from django.template.autoreload import get_template_directories, DjangoTemplates
+        from django.utils._os import to_path
+        
+        print(f"\nBASE_DIR from settings: {settings.BASE_DIR}")
+        print(f"Type: {type(settings.BASE_DIR)}")
+        
+        # Get the template backend
+        backend = engines.all()[0]
+        print(f"\nBackend engine dirs: {backend.engine.dirs}")
+        print(f"Types: {[type(d) for d in backend.engine.dirs]}")
+        
+        # Debug the get_template_directories function step by step
+        print(f"\nCurrent working directory: {Path.cwd()}")
+        
+        print("\nStep-by-step execution of get_template_directories():")
+        cwd = Path.cwd()
+        items = set()
+        
+        for backend in engines.all():
+            if not isinstance(backend, DjangoTemplates):
+                continue  # Skip non-DjangoTemplates backends
+                
+            print(f"Processing backend: {backend}")
+            print(f"  backend.engine.dirs: {backend.engine.dirs}")
+            
+            # This is the problematic line from get_template_directories
+            print("\n  Processing: cwd / to_path(dir) for dir in backend.engine.dirs")
+            for dir in backend.engine.dirs:
+                path_obj = to_path(dir)
+                print(f"    dir: {dir}")
+                print(f"    to_path(dir): {path_obj}")
+                print(f"    type: {type(path_obj)}")
+                print(f"    is_absolute(): {path_obj.is_absolute()}")
+                
+                result = cwd / path_obj
+                print(f"    cwd / to_path(dir): {result}")
+                print(f"    exists(): {result.exists()}")
+                
+                items.add(result)
+                print(f"    Added to items: {result}")
+        
+        print(f"\nFinal items set: {items}")
+        
+        # Call the actual function
+        actual_result = get_template_directories()
+        print(f"\nActual get_template_directories() result: {actual_result}")
+        
+        # Check if BASE_DIR is in the result
+        base_dir = Path(settings.BASE_DIR)
+        print(f"\nBASE_DIR: {base_dir}")
+        print(f"BASE_DIR in actual_result: {base_dir in actual_result}")
+        
+        # Check if any of the items match BASE_DIR
+        matching_items = [item for item in actual_result if item == base_dir]
+        print(f"Items matching BASE_DIR: {matching_items}")
+        
+    finally:
+        import shutil
+        shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    debug_detailed()
diff --git a/debug_issue.py b/debug_issue.py
new file mode 100644
index 0000000000..a2fad81b5c
--- /dev/null
+++ b/debug_issue.py
@@ -0,0 +1,92 @@
+#!/usr/bin/env python
+"""
+Debug script to understand the exact issue with BASE_DIR in TEMPLATES DIRS.
+"""
+import os
+import sys
+import tempfile
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def debug_template_dirs():
+    """Debug what happens with BASE_DIR in template directories."""
+    
+    # Create a temporary directory to simulate BASE_DIR
+    temp_dir = tempfile.mkdtemp()
+    base_dir = Path(temp_dir)
+    
+    print(f"BASE_DIR: {base_dir}")
+    print(f"BASE_DIR is absolute: {base_dir.is_absolute()}")
+    print(f"Current working directory: {Path.cwd()}")
+    
+    # Configure Django settings with BASE_DIR in templates
+    from django.conf import settings
+    if not settings.configured:
+        settings.configure(
+            DEBUG=True,
+            BASE_DIR=str(base_dir),
+            INSTALLED_APPS=[
+                'django.contrib.contenttypes',
+                'django.contrib.auth',
+            ],
+            TEMPLATES=[{
+                'BACKEND': 'django.template.backends.django.DjangoTemplates',
+                'DIRS': [str(base_dir)],  # BASE_DIR in DIRS
+                'APP_DIRS': True,
+            }],
+            SECRET_KEY='test-secret-key',
+        )
+    
+    import django
+    django.setup()
+    
+    from django.template import engines
+    from django.utils._os import to_path
+    
+    # Get the Django template backend
+    backend = engines.all()[0]  # Get the DjangoTemplates backend
+    print(f"\nBackend engine dirs: {backend.engine.dirs}")
+    
+    # Show what the current code does
+    cwd = Path.cwd()
+    print(f"\nCurrent working directory: {cwd}")
+    
+    print("\nWhat the current code does:")
+    for dir in backend.engine.dirs:
+        path_obj = to_path(dir)
+        print(f"  Original dir: {dir}")
+        print(f"  to_path(dir): {path_obj}")
+        print(f"  is_absolute(): {path_obj.is_absolute()}")
+        result = cwd / path_obj
+        print(f"  cwd / to_path(dir): {result}")
+        print(f"  exists(): {result.exists()}")
+        print()
+    
+    # Test the actual get_template_directories function
+    from django.template.autoreload import get_template_directories
+    print("Actual get_template_directories() result:")
+    template_dirs = get_template_directories()
+    print(f"  {template_dirs}")
+    print(f"  BASE_DIR in template_dirs: {base_dir in template_dirs}")
+    
+    # Show what the fixed code should do
+    print("\nWhat the fixed code should do:")
+    for dir in backend.engine.dirs:
+        path_obj = to_path(dir)
+        if path_obj.is_absolute():
+            result = path_obj
+        else:
+            result = cwd / path_obj
+        print(f"  Original dir: {dir}")
+        print(f"  Fixed result: {result}")
+        print(f"  exists(): {result.exists()}")
+        print()
+    
+    # Cleanup
+    import shutil
+    shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    debug_template_dirs()
diff --git a/reproduce_issue.py b/reproduce_issue.py
new file mode 100644
index 0000000000..8d45c11a21
--- /dev/null
+++ b/reproduce_issue.py
@@ -0,0 +1,96 @@
+#!/usr/bin/env python
+"""
+Script to reproduce the BASE_DIR in TEMPLATES DIRS issue.
+"""
+import os
+import sys
+import tempfile
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def test_template_autoreload_with_base_dir():
+    """Test template autoreload functionality with BASE_DIR in TEMPLATES DIRS."""
+    
+    # Create a temporary directory to simulate BASE_DIR
+    temp_dir = tempfile.mkdtemp()
+    base_dir = Path(temp_dir)
+    
+    print(f"Using temp directory as BASE_DIR: {base_dir}")
+    
+    # Test case 1: Without BASE_DIR in TEMPLATES DIRS
+    print("\n=== Test Case 1: WITHOUT BASE_DIR in TEMPLATES DIRS ===")
+    
+    # Configure Django settings without BASE_DIR in templates
+    from django.conf import settings
+    if not settings.configured:
+        settings.configure(
+            DEBUG=True,
+            BASE_DIR=str(base_dir),
+            INSTALLED_APPS=[
+                'django.contrib.contenttypes',
+                'django.contrib.auth',
+            ],
+            TEMPLATES=[{
+                'BACKEND': 'django.template.backends.django.DjangoTemplates',
+                'DIRS': [],  # Empty DIRS
+                'APP_DIRS': True,
+            }],
+            SECRET_KEY='test-secret-key',
+        )
+    
+    import django
+    django.setup()
+    
+    from django.template.autoreload import get_template_directories
+    
+    template_dirs_1 = get_template_directories()
+    print(f"Template directories: {template_dirs_1}")
+    print(f"BASE_DIR in template dirs: {base_dir in template_dirs_1}")
+    
+    # Test case 2: With BASE_DIR in TEMPLATES DIRS
+    print("\n=== Test Case 2: WITH BASE_DIR in TEMPLATES DIRS ===")
+    
+    # Reconfigure Django settings with BASE_DIR in templates
+    settings.TEMPLATES[0]['DIRS'] = [str(base_dir)]
+    
+    # Reset the template engines to pick up new settings
+    from django.template import engines
+    engines._templates = None
+    engines._engines = {}
+    
+    template_dirs_2 = get_template_directories()
+    print(f"Template directories: {template_dirs_2}")
+    print(f"BASE_DIR in template dirs: {base_dir in template_dirs_2}")
+    
+    # Check if the issue exists
+    issue_exists = base_dir not in template_dirs_2
+    
+    # Cleanup
+    import shutil
+    shutil.rmtree(temp_dir)
+    
+    return issue_exists
+
+def main():
+    print("=== Django BASE_DIR Autoreload Issue Reproduction ===\n")
+    
+    try:
+        issue_exists = test_template_autoreload_with_base_dir()
+        
+        if issue_exists:
+            print("\n✓ Issue reproduced: BASE_DIR in TEMPLATES DIRS is not being watched")
+            return 0
+        else:
+            print("\n✓ Issue appears to be fixed: BASE_DIR is correctly being watched")
+            return 0
+            
+    except Exception as e:
+        print(f"\n✗ Error during testing: {e}")
+        import traceback
+        traceback.print_exc()
+        return 1
+
+if __name__ == '__main__':
+    sys.exit(main())
diff --git a/test_file_change_detection.py b/test_file_change_detection.py
new file mode 100644
index 0000000000..1f63302aea
--- /dev/null
+++ b/test_file_change_detection.py
@@ -0,0 +1,139 @@
+#!/usr/bin/env python
+"""
+Test the actual file change detection mechanism.
+"""
+import os
+import sys
+import tempfile
+import time
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def test_file_change_detection():
+    """Test the file change detection mechanism."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating project in: {project_path}")
+    
+    # Create project structure
+    project_path.mkdir(parents=True)
+    (project_path / '__init__.py').touch()
+    
+    # Create settings.py with BASE_DIR in TEMPLATES DIRS
+    settings_content = f'''
+import os
+from pathlib import Path
+
+BASE_DIR = Path(__file__).resolve().parent.parent
+SECRET_KEY = 'django-insecure-test-key'
+DEBUG = True
+ALLOWED_HOSTS = []
+INSTALLED_APPS = [
+    'django.contrib.contenttypes',
+    'django.contrib.auth',
+]
+ROOT_URLCONF = 'testproject.urls'
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [BASE_DIR],  # BASE_DIR in DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.request',
+            ],
+        }},
+    }},
+]
+USE_TZ = True
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    (project_path / 'urls.py').write_text('from django.urls import path\nurlpatterns = []')
+    
+    try:
+        # Set up environment
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        import django
+        django.setup()
+        
+        from django.utils.autoreload import StatReloader, autoreload_started
+        from django.template.autoreload import template_changed
+        
+        print(f"\n=== Testing file change detection ===")
+        
+        # Set up the reloader
+        reloader = StatReloader()
+        autoreload_started.send(sender=reloader)
+        
+        # Create a test file in BASE_DIR
+        test_file = project_path / 'test_template.html'
+        test_file.write_text('<html><body>Original content</body></html>')
+        print(f"Created test file: {test_file}")
+        
+        # Get initial snapshot
+        initial_snapshot = dict(reloader.snapshot_files())
+        print(f"Initial snapshot contains {len(initial_snapshot)} files")
+        print(f"Test file in initial snapshot: {test_file in initial_snapshot}")
+        if test_file in initial_snapshot:
+            print(f"Test file initial mtime: {initial_snapshot[test_file]}")
+        
+        # Test template_changed function directly
+        print(f"\n=== Testing template_changed function ===")
+        result = template_changed(None, test_file)
+        print(f"template_changed result: {result}")
+        
+        # Simulate file change
+        time.sleep(0.1)  # Small delay to ensure different mtime
+        test_file.write_text('<html><body>Modified content</body></html>')
+        print(f"Modified test file")
+        
+        # Get new snapshot
+        new_snapshot = dict(reloader.snapshot_files())
+        print(f"Test file in new snapshot: {test_file in new_snapshot}")
+        if test_file in new_snapshot:
+            print(f"Test file new mtime: {new_snapshot[test_file]}")
+            
+            # Check if mtime changed
+            if test_file in initial_snapshot and test_file in new_snapshot:
+                mtime_changed = new_snapshot[test_file] > initial_snapshot[test_file]
+                print(f"Mtime changed: {mtime_changed}")
+                
+                if mtime_changed:
+                    print("✓ File change detected correctly")
+                    return False
+                else:
+                    print("✗ File change NOT detected")
+                    return True
+        
+        print("✗ Test file not found in snapshots")
+        return True
+        
+    finally:
+        import shutil
+        shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    issue_exists = test_file_change_detection()
+    if issue_exists:
+        print("\n✓ Issue reproduced: File change detection not working")
+    else:
+        print("\n✗ File change detection working correctly")
diff --git a/test_manual_project.py b/test_manual_project.py
new file mode 100644
index 0000000000..140b55a1f8
--- /dev/null
+++ b/test_manual_project.py
@@ -0,0 +1,240 @@
+#!/usr/bin/env python
+"""
+Manually create a Django project structure to test the issue.
+"""
+import os
+import sys
+import tempfile
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def create_manual_project():
+    """Manually create a Django project structure."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating manual project in: {project_path}")
+    
+    # Create project directory
+    project_path.mkdir(parents=True)
+    
+    # Create __init__.py
+    (project_path / '__init__.py').touch()
+    
+    # Create settings.py
+    settings_content = f'''
+import os
+from pathlib import Path
+
+# Build paths inside the project like this: BASE_DIR / 'subdir'.
+BASE_DIR = Path(__file__).resolve().parent.parent
+
+# SECURITY WARNING: keep the secret key used in production secret!
+SECRET_KEY = 'django-insecure-test-key'
+
+# SECURITY WARNING: don't run with debug turned on in production!
+DEBUG = True
+
+ALLOWED_HOSTS = []
+
+# Application definition
+INSTALLED_APPS = [
+    'django.contrib.admin',
+    'django.contrib.auth',
+    'django.contrib.contenttypes',
+    'django.contrib.sessions',
+    'django.contrib.messages',
+    'django.contrib.staticfiles',
+]
+
+MIDDLEWARE = [
+    'django.middleware.security.SecurityMiddleware',
+    'django.contrib.sessions.middleware.SessionMiddleware',
+    'django.middleware.common.CommonMiddleware',
+    'django.middleware.csrf.CsrfViewMiddleware',
+    'django.contrib.auth.middleware.AuthenticationMiddleware',
+    'django.contrib.messages.middleware.MessageMiddleware',
+    'django.middleware.clickjacking.XFrameOptionsMiddleware',
+]
+
+ROOT_URLCONF = 'testproject.urls'
+
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [],  # Start with empty DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.debug',
+                'django.template.context_processors.request',
+                'django.contrib.auth.context_processors.auth',
+                'django.contrib.messages.context_processors.messages',
+            ],
+        }},
+    }},
+]
+
+WSGI_APPLICATION = 'testproject.wsgi.application'
+
+# Database
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+
+# Password validation
+AUTH_PASSWORD_VALIDATORS = [
+    {{
+        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
+    }},
+    {{
+        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
+    }},
+    {{
+        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
+    }},
+    {{
+        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
+    }},
+]
+
+# Internationalization
+LANGUAGE_CODE = 'en-us'
+TIME_ZONE = 'UTC'
+USE_I18N = True
+USE_TZ = True
+
+# Static files (CSS, JavaScript, Images)
+STATIC_URL = 'static/'
+
+# Default primary key field type
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    urls_content = '''
+from django.contrib import admin
+from django.urls import path
+
+urlpatterns = [
+    path('admin/', admin.site.urls),
+]
+'''
+    (project_path / 'urls.py').write_text(urls_content)
+    
+    # Create wsgi.py
+    wsgi_content = '''
+import os
+from django.core.wsgi import get_wsgi_application
+
+os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'testproject.settings')
+
+application = get_wsgi_application()
+'''
+    (project_path / 'wsgi.py').write_text(wsgi_content)
+    
+    # Create manage.py
+    manage_content = f'''#!/usr/bin/env python
+import os
+import sys
+
+if __name__ == '__main__':
+    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'testproject.settings')
+    try:
+        from django.core.management import execute_from_command_line
+    except ImportError as exc:
+        raise ImportError(
+            "Couldn't import Django. Are you sure it's installed and "
+            "available on your PYTHONPATH environment variable? Did you "
+            "forget to activate a virtual environment?"
+        ) from exc
+    execute_from_command_line(sys.argv)
+'''
+    manage_file = project_path.parent / 'manage.py'
+    with open(manage_file, 'w') as f:
+        f.write(manage_content)
+    os.chmod(manage_file, 0o755)
+    
+    return project_path, settings_file
+
+def test_issue():
+    """Test the BASE_DIR in TEMPLATES DIRS issue."""
+    project_path, settings_file = create_manual_project()
+    
+    try:
+        # Add project directory to Python path
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        # Test 1: Original settings (empty DIRS)
+        print("\n=== Test 1: Original settings (empty DIRS) ===")
+        
+        import django
+        django.setup()
+        
+        from django.template.autoreload import get_template_directories
+        from django.conf import settings
+        
+        template_dirs_1 = get_template_directories()
+        base_dir = Path(settings.BASE_DIR)
+        
+        print(f"BASE_DIR: {base_dir}")
+        print(f"Template directories: {template_dirs_1}")
+        print(f"BASE_DIR in template_dirs: {base_dir in template_dirs_1}")
+        
+        # Test 2: Add BASE_DIR to DIRS
+        print("\n=== Test 2: Add BASE_DIR to TEMPLATES DIRS ===")
+        
+        # Read and modify settings
+        with open(settings_file, 'r') as f:
+            content = f.read()
+        
+        modified_content = content.replace(
+            "'DIRS': [],",
+            "'DIRS': [BASE_DIR],"
+        )
+        
+        with open(settings_file, 'w') as f:
+            f.write(modified_content)
+        
+        # Reset Django to pick up new settings
+        import importlib
+        import testproject.settings
+        importlib.reload(testproject.settings)
+        
+        # Reset template engines
+        from django.template import engines
+        engines._templates = None
+        engines._engines = {}
+        
+        template_dirs_2 = get_template_directories()
+        print(f"Template directories: {template_dirs_2}")
+        print(f"BASE_DIR in template_dirs: {base_dir in template_dirs_2}")
+        
+        # Check if issue exists
+        issue_exists = base_dir not in template_dirs_2
+        
+        return issue_exists
+        
+    finally:
+        # Cleanup
+        import shutil
+        shutil.rmtree(project_path.parent)
+
+if __name__ == '__main__':
+    issue_exists = test_issue()
+    if issue_exists:
+        print("\n✓ Issue reproduced: BASE_DIR in TEMPLATES DIRS is not being watched")
+    else:
+        print("\n✗ Issue not reproduced: BASE_DIR is correctly being watched")
diff --git a/test_path_behavior.py b/test_path_behavior.py
new file mode 100644
index 0000000000..ec038a1b0d
--- /dev/null
+++ b/test_path_behavior.py
@@ -0,0 +1,51 @@
+#!/usr/bin/env python
+"""
+Test Path behavior with absolute paths.
+"""
+from pathlib import Path
+
+def test_path_behavior():
+    """Test how Path behaves with absolute paths."""
+    
+    # Test case 1: String absolute path
+    abs_path_str = "/tmp/test"
+    cwd = Path.cwd()
+    
+    result1 = cwd / Path(abs_path_str)
+    print(f"cwd / Path('/tmp/test') = {result1}")
+    print(f"exists(): {result1.exists()}")
+    
+    # Test case 2: Path object absolute path
+    abs_path_obj = Path("/tmp/test")
+    result2 = cwd / abs_path_obj
+    print(f"cwd / Path('/tmp/test') = {result2}")
+    print(f"exists(): {result2.exists()}")
+    
+    # Test case 3: What happens with the actual BASE_DIR scenario
+    import tempfile
+    temp_dir = tempfile.mkdtemp()
+    base_dir = Path(temp_dir)
+    
+    print(f"\nBASE_DIR scenario:")
+    print(f"BASE_DIR: {base_dir}")
+    print(f"cwd: {cwd}")
+    print(f"BASE_DIR.is_absolute(): {base_dir.is_absolute()}")
+    
+    result3 = cwd / base_dir
+    print(f"cwd / BASE_DIR = {result3}")
+    print(f"exists(): {result3.exists()}")
+    
+    # Test case 4: What should happen
+    if base_dir.is_absolute():
+        result4 = base_dir
+    else:
+        result4 = cwd / base_dir
+    print(f"Correct result: {result4}")
+    print(f"exists(): {result4.exists()}")
+    
+    # Cleanup
+    import shutil
+    shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    test_path_behavior()
diff --git a/test_performance_issue.py b/test_performance_issue.py
new file mode 100644
index 0000000000..9e105874b8
--- /dev/null
+++ b/test_performance_issue.py
@@ -0,0 +1,175 @@
+#!/usr/bin/env python
+"""
+Test if the issue is related to performance when watching too many files.
+"""
+import os
+import sys
+import tempfile
+import time
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def test_performance_issue():
+    """Test if the issue is performance-related."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating project in: {project_path}")
+    
+    # Create project structure
+    project_path.mkdir(parents=True)
+    (project_path / '__init__.py').touch()
+    
+    # Create many files in BASE_DIR to simulate a real project
+    print("Creating many files in BASE_DIR...")
+    for i in range(100):
+        (project_path / f'file_{i}.py').write_text(f'# File {i}\n')
+        (project_path / f'template_{i}.html').write_text(f'<html>Template {i}</html>')
+    
+    # Create subdirectories with files
+    for subdir in ['static', 'media', 'templates', 'apps']:
+        sub_path = project_path / subdir
+        sub_path.mkdir()
+        for i in range(50):
+            (sub_path / f'file_{i}.txt').write_text(f'Content {i}')
+    
+    # Create settings.py with BASE_DIR in TEMPLATES DIRS
+    settings_content = f'''
+import os
+from pathlib import Path
+
+BASE_DIR = Path(__file__).resolve().parent.parent
+SECRET_KEY = 'django-insecure-test-key'
+DEBUG = True
+ALLOWED_HOSTS = []
+INSTALLED_APPS = [
+    'django.contrib.contenttypes',
+    'django.contrib.auth',
+]
+ROOT_URLCONF = 'testproject.urls'
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [BASE_DIR],  # BASE_DIR in DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.request',
+            ],
+        }},
+    }},
+]
+USE_TZ = True
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    (project_path / 'urls.py').write_text('from django.urls import path\nurlpatterns = []')
+    
+    try:
+        # Set up environment
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        import django
+        django.setup()
+        
+        from django.utils.autoreload import StatReloader, autoreload_started
+        
+        print(f"\n=== Test 1: Without BASE_DIR in TEMPLATES DIRS ===")
+        
+        # Test without BASE_DIR in TEMPLATES DIRS
+        from django.conf import settings
+        settings.TEMPLATES[0]['DIRS'] = []
+        
+        # Reset template engines
+        from django.template import engines
+        engines._templates = None
+        engines._engines = {}
+        
+        reloader1 = StatReloader()
+        
+        start_time = time.time()
+        autoreload_started.send(sender=reloader1)
+        watched_files_1 = list(reloader1.watched_files())
+        end_time = time.time()
+        
+        print(f"Files watched: {len(watched_files_1)}")
+        print(f"Time to collect files: {end_time - start_time:.3f}s")
+        
+        print(f"\n=== Test 2: With BASE_DIR in TEMPLATES DIRS ===")
+        
+        # Test with BASE_DIR in TEMPLATES DIRS
+        settings.TEMPLATES[0]['DIRS'] = [str(settings.BASE_DIR)]
+        
+        # Reset template engines
+        engines._templates = None
+        engines._engines = {}
+        
+        reloader2 = StatReloader()
+        
+        start_time = time.time()
+        autoreload_started.send(sender=reloader2)
+        watched_files_2 = list(reloader2.watched_files())
+        end_time = time.time()
+        
+        print(f"Files watched: {len(watched_files_2)}")
+        print(f"Time to collect files: {end_time - start_time:.3f}s")
+        
+        # Check the difference
+        additional_files = len(watched_files_2) - len(watched_files_1)
+        # time_increase calculation will be done below
+        
+        print(f"\n=== Comparison ===")
+        print(f"Additional files watched: {additional_files}")
+        print(f"Performance impact: Significant if {additional_files} > 200")
+        
+        # Test file snapshot performance
+        print(f"\n=== Testing file snapshot performance ===")
+        
+        start_time = time.time()
+        snapshot_1 = list(reloader1.snapshot_files())
+        end_time = time.time()
+        snapshot_time_1 = end_time - start_time
+        
+        start_time = time.time()
+        snapshot_2 = list(reloader2.snapshot_files())
+        end_time = time.time()
+        snapshot_time_2 = end_time - start_time
+        
+        print(f"Snapshot time without BASE_DIR: {snapshot_time_1:.3f}s")
+        print(f"Snapshot time with BASE_DIR: {snapshot_time_2:.3f}s")
+        print(f"Snapshot time increase: {snapshot_time_2 - snapshot_time_1:.3f}s")
+        
+        # If the snapshot takes too long, it could cause the autoreloader to miss changes
+        if snapshot_time_2 > 0.5:  # If it takes more than 0.5 seconds
+            print("✗ Issue reproduced: File snapshot takes too long with BASE_DIR in TEMPLATES DIRS")
+            return True
+        else:
+            print("✓ File snapshot performance is acceptable")
+            return False
+        
+    finally:
+        import shutil
+        shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    issue_exists = test_performance_issue()
+    if issue_exists:
+        print("\n✓ Performance issue reproduced!")
+    else:
+        print("\n✗ No performance issue found")
diff --git a/test_real_project.py b/test_real_project.py
new file mode 100644
index 0000000000..8b9c9aeebb
--- /dev/null
+++ b/test_real_project.py
@@ -0,0 +1,131 @@
+#!/usr/bin/env python
+"""
+Test with a real Django project structure to reproduce the issue.
+"""
+import os
+import sys
+import tempfile
+import subprocess
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def create_real_project():
+    """Create a real Django project and test the issue."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating test project in: {project_path}")
+    
+    # Create Django project using django-admin from the current Django installation
+    django_admin_script = '/workspace/django__django__4.1/django/bin/django-admin.py'
+    if not os.path.exists(django_admin_script):
+        # Create a simple django-admin script
+        with open(django_admin_script, 'w') as f:
+            f.write('''#!/usr/bin/env python
+import os
+import sys
+import django
+from django.core import management
+
+if __name__ == "__main__":
+    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django.conf.global_settings')
+    django.setup()
+    management.execute_from_command_line()
+''')
+        os.chmod(django_admin_script, 0o755)
+    
+    result = subprocess.run([
+        sys.executable, django_admin_script, 'startproject', project_name
+    ], cwd=temp_dir, capture_output=True, text=True)
+    
+    if result.returncode != 0:
+        print(f"Failed to create project: {result.stderr}")
+        return None, None
+    
+    # Get the settings file
+    settings_file = project_path / project_name / 'settings.py'
+    
+    return project_path, settings_file
+
+def test_with_real_project():
+    """Test the issue with a real Django project."""
+    project_path, settings_file = create_real_project()
+    if not project_path:
+        return False
+    
+    try:
+        print(f"Project created at: {project_path}")
+        
+        # Read original settings
+        with open(settings_file, 'r') as f:
+            original_content = f.read()
+        
+        print("\n=== Test 1: Original settings (empty DIRS) ===")
+        os.chdir(project_path)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        # Import Django and test
+        import django
+        from django.template.autoreload import get_template_directories
+        
+        django.setup()
+        
+        template_dirs_1 = get_template_directories()
+        print(f"Template directories: {template_dirs_1}")
+        
+        # Test 2: Add BASE_DIR to DIRS
+        print("\n=== Test 2: Add BASE_DIR to TEMPLATES DIRS ===")
+        
+        # Modify settings to add BASE_DIR
+        modified_content = original_content.replace(
+            "'DIRS': [],",
+            "'DIRS': [BASE_DIR],"
+        )
+        
+        with open(settings_file, 'w') as f:
+            f.write(modified_content)
+        
+        # Reset Django to pick up new settings
+        from django.utils import autoreload
+        import importlib
+        import testproject.settings
+        importlib.reload(testproject.settings)
+        
+        # Reset template engines
+        from django.template import engines
+        engines._templates = None
+        engines._engines = {}
+        
+        template_dirs_2 = get_template_directories()
+        print(f"Template directories: {template_dirs_2}")
+        
+        # Check if BASE_DIR is in the template directories
+        from django.conf import settings
+        base_dir = Path(settings.BASE_DIR)
+        base_dir_in_template_dirs = base_dir in template_dirs_2
+        
+        print(f"BASE_DIR: {base_dir}")
+        print(f"BASE_DIR in template_dirs: {base_dir_in_template_dirs}")
+        
+        return not base_dir_in_template_dirs  # True if issue exists
+        
+    except Exception as e:
+        print(f"Error: {e}")
+        import traceback
+        traceback.print_exc()
+        return False
+        
+    finally:
+        # Cleanup
+        import shutil
+        shutil.rmtree(project_path.parent)
+
+if __name__ == '__main__':
+    issue_exists = test_with_real_project()
+    if issue_exists:
+        print("\n✓ Issue reproduced!")
+    else:
+        print("\n✗ Issue not reproduced")
diff --git a/test_runserver_simulation.py b/test_runserver_simulation.py
new file mode 100644
index 0000000000..e84e453b50
--- /dev/null
+++ b/test_runserver_simulation.py
@@ -0,0 +1,141 @@
+#!/usr/bin/env python
+"""
+Simulate the runserver behavior to reproduce the issue.
+"""
+import os
+import sys
+import tempfile
+import threading
+import time
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def test_runserver_simulation():
+    """Test the runserver behavior with BASE_DIR in TEMPLATES DIRS."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating project in: {project_path}")
+    
+    # Create project structure
+    project_path.mkdir(parents=True)
+    (project_path / '__init__.py').touch()
+    
+    # Create settings.py with BASE_DIR in TEMPLATES DIRS
+    settings_content = f'''
+import os
+from pathlib import Path
+
+BASE_DIR = Path(__file__).resolve().parent.parent
+SECRET_KEY = 'django-insecure-test-key'
+DEBUG = True
+ALLOWED_HOSTS = []
+INSTALLED_APPS = [
+    'django.contrib.contenttypes',
+    'django.contrib.auth',
+]
+ROOT_URLCONF = 'testproject.urls'
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [BASE_DIR],  # BASE_DIR in DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.request',
+            ],
+        }},
+    }},
+]
+USE_TZ = True
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    (project_path / 'urls.py').write_text('from django.urls import path\nurlpatterns = []')
+    
+    try:
+        # Set up environment
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        import django
+        django.setup()
+        
+        from django.utils.autoreload import StatReloader, autoreload_started
+        from django.template.autoreload import watch_for_template_changes
+        from unittest.mock import MagicMock
+        
+        print(f"\n=== Simulating autoreloader startup ===")
+        
+        # Create a StatReloader instance (like runserver does)
+        reloader = StatReloader()
+        
+        print(f"Initial reloader state:")
+        print(f"  extra_files: {reloader.extra_files}")
+        print(f"  directory_globs: {reloader.directory_globs}")
+        
+        # Simulate the autoreload_started signal (which calls watch_for_template_changes)
+        print(f"\n=== Sending autoreload_started signal ===")
+        autoreload_started.send(sender=reloader)
+        
+        print(f"After autoreload_started signal:")
+        print(f"  extra_files: {reloader.extra_files}")
+        print(f"  directory_globs: {reloader.directory_globs}")
+        
+        # Test what files would be watched
+        print(f"\n=== Testing watched files ===")
+        watched_files = list(reloader.watched_files())
+        print(f"Number of watched files: {len(watched_files)}")
+        print(f"First 10 watched files: {watched_files[:10]}")
+        
+        # Check if BASE_DIR files are being watched
+        from django.conf import settings
+        base_dir = Path(settings.BASE_DIR)
+        
+        base_dir_files = [f for f in watched_files if base_dir in f.parents or f == base_dir]
+        print(f"Files in BASE_DIR being watched: {len(base_dir_files)}")
+        if base_dir_files:
+            print(f"Sample BASE_DIR files: {base_dir_files[:5]}")
+        
+        # Create a test file in BASE_DIR and see if it gets watched
+        test_file = base_dir / 'test_template.html'
+        test_file.write_text('<html><body>Test</body></html>')
+        print(f"\nCreated test file: {test_file}")
+        
+        # Refresh watched files
+        watched_files_after = list(reloader.watched_files())
+        test_file_watched = test_file in watched_files_after
+        print(f"Test file being watched: {test_file_watched}")
+        
+        if not test_file_watched:
+            print("✗ Issue reproduced: Files in BASE_DIR are not being watched")
+            return True
+        else:
+            print("✓ Files in BASE_DIR are being watched correctly")
+            return False
+        
+    finally:
+        import shutil
+        shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    issue_exists = test_runserver_simulation()
+    if issue_exists:
+        print("\n✓ Issue reproduced!")
+    else:
+        print("\n✗ Issue not reproduced")

2026-01-06 15:32:18,597 - INFO - ------------------------------
2026-01-06 15:32:18,597 - INFO - END Runtime Completion Fn
2026-01-06 15:32:18,598 - INFO - ------------------------------
2026-01-06 15:32:18,598 - INFO - Got git diff for instance django__django-15388:
--------
diff --git a/debug_autoreload.py b/debug_autoreload.py
new file mode 100644
index 0000000000..c09e157a4d
--- /dev/null
+++ b/debug_autoreload.py
@@ -0,0 +1,121 @@
+#!/usr/bin/env python
+"""
+Debug the autoreload mechanism to see where the issue really is.
+"""
+import os
+import sys
+import tempfile
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def debug_autoreload():
+    """Debug the autoreload mechanism."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating project in: {project_path}")
+    
+    # Create project structure
+    project_path.mkdir(parents=True)
+    (project_path / '__init__.py').touch()
+    
+    # Create settings.py with BASE_DIR in TEMPLATES DIRS
+    settings_content = f'''
+import os
+from pathlib import Path
+
+BASE_DIR = Path(__file__).resolve().parent.parent
+SECRET_KEY = 'django-insecure-test-key'
+DEBUG = True
+ALLOWED_HOSTS = []
+INSTALLED_APPS = [
+    'django.contrib.contenttypes',
+    'django.contrib.auth',
+]
+ROOT_URLCONF = 'testproject.urls'
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [BASE_DIR],  # BASE_DIR in DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.request',
+            ],
+        }},
+    }},
+]
+USE_TZ = True
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    (project_path / 'urls.py').write_text('from django.urls import path\nurlpatterns = []')
+    
+    try:
+        # Set up environment
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        import django
+        django.setup()
+        
+        from django.template.autoreload import get_template_directories, watch_for_template_changes
+        from django.utils.autoreload import BaseReloader
+        from unittest.mock import MagicMock
+        
+        print(f"\n=== Testing get_template_directories() ===")
+        template_dirs = get_template_directories()
+        print(f"Template directories: {template_dirs}")
+        
+        from django.conf import settings
+        base_dir = Path(settings.BASE_DIR)
+        print(f"BASE_DIR: {base_dir}")
+        print(f"BASE_DIR in template_dirs: {base_dir in template_dirs}")
+        
+        print(f"\n=== Testing watch_for_template_changes() ===")
+        mock_reloader = MagicMock()
+        watch_for_template_changes(mock_reloader)
+        
+        print(f"watch_dir calls:")
+        for call in mock_reloader.watch_dir.call_args_list:
+            print(f"  {call}")
+        
+        print(f"\n=== Testing file change detection ===")
+        # Create a test file in BASE_DIR
+        test_file = base_dir / 'test_template.html'
+        test_file.write_text('<html><body>Test</body></html>')
+        print(f"Created test file: {test_file}")
+        
+        # Test if the file would be detected as changed
+        from django.template.autoreload import template_changed
+        result = template_changed(None, test_file)
+        print(f"template_changed result: {result}")
+        
+        # Test the file watching logic
+        print(f"\n=== Testing file watching logic ===")
+        for template_dir in template_dirs:
+            print(f"Template dir: {template_dir}")
+            print(f"  test_file parents: {test_file.parents}")
+            print(f"  template_dir in test_file.parents: {template_dir in test_file.parents}")
+        
+    finally:
+        import shutil
+        shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    debug_autoreload()
diff --git a/debug_detailed.py b/debug_detailed.py
new file mode 100644
index 0000000000..4309e67bbc
--- /dev/null
+++ b/debug_detailed.py
@@ -0,0 +1,140 @@
+#!/usr/bin/env python
+"""
+Detailed debug of the BASE_DIR in TEMPLATES DIRS issue.
+"""
+import os
+import sys
+import tempfile
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def debug_detailed():
+    """Debug the issue in detail."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating project in: {project_path}")
+    
+    # Create project structure
+    project_path.mkdir(parents=True)
+    (project_path / '__init__.py').touch()
+    
+    # Create settings.py with BASE_DIR in TEMPLATES DIRS
+    settings_content = f'''
+import os
+from pathlib import Path
+
+BASE_DIR = Path(__file__).resolve().parent.parent
+SECRET_KEY = 'django-insecure-test-key'
+DEBUG = True
+ALLOWED_HOSTS = []
+INSTALLED_APPS = [
+    'django.contrib.contenttypes',
+    'django.contrib.auth',
+]
+ROOT_URLCONF = 'testproject.urls'
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [BASE_DIR],  # BASE_DIR in DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.request',
+            ],
+        }},
+    }},
+]
+USE_TZ = True
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    (project_path / 'urls.py').write_text('from django.urls import path\nurlpatterns = []')
+    
+    try:
+        # Set up environment
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        import django
+        django.setup()
+        
+        from django.conf import settings
+        from django.template import engines
+        from django.template.autoreload import get_template_directories, DjangoTemplates
+        from django.utils._os import to_path
+        
+        print(f"\nBASE_DIR from settings: {settings.BASE_DIR}")
+        print(f"Type: {type(settings.BASE_DIR)}")
+        
+        # Get the template backend
+        backend = engines.all()[0]
+        print(f"\nBackend engine dirs: {backend.engine.dirs}")
+        print(f"Types: {[type(d) for d in backend.engine.dirs]}")
+        
+        # Debug the get_template_directories function step by step
+        print(f"\nCurrent working directory: {Path.cwd()}")
+        
+        print("\nStep-by-step execution of get_template_directories():")
+        cwd = Path.cwd()
+        items = set()
+        
+        for backend in engines.all():
+            if not isinstance(backend, DjangoTemplates):
+                continue  # Skip non-DjangoTemplates backends
+                
+            print(f"Processing backend: {backend}")
+            print(f"  backend.engine.dirs: {backend.engine.dirs}")
+            
+            # This is the problematic line from get_template_directories
+            print("\n  Processing: cwd / to_path(dir) for dir in backend.engine.dirs")
+            for dir in backend.engine.dirs:
+                path_obj = to_path(dir)
+                print(f"    dir: {dir}")
+                print(f"    to_path(dir): {path_obj}")
+                print(f"    type: {type(path_obj)}")
+                print(f"    is_absolute(): {path_obj.is_absolute()}")
+                
+                result = cwd / path_obj
+                print(f"    cwd / to_path(dir): {result}")
+                print(f"    exists(): {result.exists()}")
+                
+                items.add(result)
+                print(f"    Added to items: {result}")
+        
+        print(f"\nFinal items set: {items}")
+        
+        # Call the actual function
+        actual_result = get_template_directories()
+        print(f"\nActual get_template_directories() result: {actual_result}")
+        
+        # Check if BASE_DIR is in the result
+        base_dir = Path(settings.BASE_DIR)
+        print(f"\nBASE_DIR: {base_dir}")
+        print(f"BASE_DIR in actual_result: {base_dir in actual_result}")
+        
+        # Check if any of the items match BASE_DIR
+        matching_items = [item for item in actual_result if item == base_dir]
+        print(f"Items matching BASE_DIR: {matching_items}")
+        
+    finally:
+        import shutil
+        shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    debug_detailed()
diff --git a/debug_issue.py b/debug_issue.py
new file mode 100644
index 0000000000..a2fad81b5c
--- /dev/null
+++ b/debug_issue.py
@@ -0,0 +1,92 @@
+#!/usr/bin/env python
+"""
+Debug script to understand the exact issue with BASE_DIR in TEMPLATES DIRS.
+"""
+import os
+import sys
+import tempfile
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def debug_template_dirs():
+    """Debug what happens with BASE_DIR in template directories."""
+    
+    # Create a temporary directory to simulate BASE_DIR
+    temp_dir = tempfile.mkdtemp()
+    base_dir = Path(temp_dir)
+    
+    print(f"BASE_DIR: {base_dir}")
+    print(f"BASE_DIR is absolute: {base_dir.is_absolute()}")
+    print(f"Current working directory: {Path.cwd()}")
+    
+    # Configure Django settings with BASE_DIR in templates
+    from django.conf import settings
+    if not settings.configured:
+        settings.configure(
+            DEBUG=True,
+            BASE_DIR=str(base_dir),
+            INSTALLED_APPS=[
+                'django.contrib.contenttypes',
+                'django.contrib.auth',
+            ],
+            TEMPLATES=[{
+                'BACKEND': 'django.template.backends.django.DjangoTemplates',
+                'DIRS': [str(base_dir)],  # BASE_DIR in DIRS
+                'APP_DIRS': True,
+            }],
+            SECRET_KEY='test-secret-key',
+        )
+    
+    import django
+    django.setup()
+    
+    from django.template import engines
+    from django.utils._os import to_path
+    
+    # Get the Django template backend
+    backend = engines.all()[0]  # Get the DjangoTemplates backend
+    print(f"\nBackend engine dirs: {backend.engine.dirs}")
+    
+    # Show what the current code does
+    cwd = Path.cwd()
+    print(f"\nCurrent working directory: {cwd}")
+    
+    print("\nWhat the current code does:")
+    for dir in backend.engine.dirs:
+        path_obj = to_path(dir)
+        print(f"  Original dir: {dir}")
+        print(f"  to_path(dir): {path_obj}")
+        print(f"  is_absolute(): {path_obj.is_absolute()}")
+        result = cwd / path_obj
+        print(f"  cwd / to_path(dir): {result}")
+        print(f"  exists(): {result.exists()}")
+        print()
+    
+    # Test the actual get_template_directories function
+    from django.template.autoreload import get_template_directories
+    print("Actual get_template_directories() result:")
+    template_dirs = get_template_directories()
+    print(f"  {template_dirs}")
+    print(f"  BASE_DIR in template_dirs: {base_dir in template_dirs}")
+    
+    # Show what the fixed code should do
+    print("\nWhat the fixed code should do:")
+    for dir in backend.engine.dirs:
+        path_obj = to_path(dir)
+        if path_obj.is_absolute():
+            result = path_obj
+        else:
+            result = cwd / path_obj
+        print(f"  Original dir: {dir}")
+        print(f"  Fixed result: {result}")
+        print(f"  exists(): {result.exists()}")
+        print()
+    
+    # Cleanup
+    import shutil
+    shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    debug_template_dirs()
diff --git a/reproduce_issue.py b/reproduce_issue.py
new file mode 100644
index 0000000000..8d45c11a21
--- /dev/null
+++ b/reproduce_issue.py
@@ -0,0 +1,96 @@
+#!/usr/bin/env python
+"""
+Script to reproduce the BASE_DIR in TEMPLATES DIRS issue.
+"""
+import os
+import sys
+import tempfile
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def test_template_autoreload_with_base_dir():
+    """Test template autoreload functionality with BASE_DIR in TEMPLATES DIRS."""
+    
+    # Create a temporary directory to simulate BASE_DIR
+    temp_dir = tempfile.mkdtemp()
+    base_dir = Path(temp_dir)
+    
+    print(f"Using temp directory as BASE_DIR: {base_dir}")
+    
+    # Test case 1: Without BASE_DIR in TEMPLATES DIRS
+    print("\n=== Test Case 1: WITHOUT BASE_DIR in TEMPLATES DIRS ===")
+    
+    # Configure Django settings without BASE_DIR in templates
+    from django.conf import settings
+    if not settings.configured:
+        settings.configure(
+            DEBUG=True,
+            BASE_DIR=str(base_dir),
+            INSTALLED_APPS=[
+                'django.contrib.contenttypes',
+                'django.contrib.auth',
+            ],
+            TEMPLATES=[{
+                'BACKEND': 'django.template.backends.django.DjangoTemplates',
+                'DIRS': [],  # Empty DIRS
+                'APP_DIRS': True,
+            }],
+            SECRET_KEY='test-secret-key',
+        )
+    
+    import django
+    django.setup()
+    
+    from django.template.autoreload import get_template_directories
+    
+    template_dirs_1 = get_template_directories()
+    print(f"Template directories: {template_dirs_1}")
+    print(f"BASE_DIR in template dirs: {base_dir in template_dirs_1}")
+    
+    # Test case 2: With BASE_DIR in TEMPLATES DIRS
+    print("\n=== Test Case 2: WITH BASE_DIR in TEMPLATES DIRS ===")
+    
+    # Reconfigure Django settings with BASE_DIR in templates
+    settings.TEMPLATES[0]['DIRS'] = [str(base_dir)]
+    
+    # Reset the template engines to pick up new settings
+    from django.template import engines
+    engines._templates = None
+    engines._engines = {}
+    
+    template_dirs_2 = get_template_directories()
+    print(f"Template directories: {template_dirs_2}")
+    print(f"BASE_DIR in template dirs: {base_dir in template_dirs_2}")
+    
+    # Check if the issue exists
+    issue_exists = base_dir not in template_dirs_2
+    
+    # Cleanup
+    import shutil
+    shutil.rmtree(temp_dir)
+    
+    return issue_exists
+
+def main():
+    print("=== Django BASE_DIR Autoreload Issue Reproduction ===\n")
+    
+    try:
+        issue_exists = test_template_autoreload_with_base_dir()
+        
+        if issue_exists:
+            print("\n✓ Issue reproduced: BASE_DIR in TEMPLATES DIRS is not being watched")
+            return 0
+        else:
+            print("\n✓ Issue appears to be fixed: BASE_DIR is correctly being watched")
+            return 0
+            
+    except Exception as e:
+        print(f"\n✗ Error during testing: {e}")
+        import traceback
+        traceback.print_exc()
+        return 1
+
+if __name__ == '__main__':
+    sys.exit(main())
diff --git a/test_file_change_detection.py b/test_file_change_detection.py
new file mode 100644
index 0000000000..1f63302aea
--- /dev/null
+++ b/test_file_change_detection.py
@@ -0,0 +1,139 @@
+#!/usr/bin/env python
+"""
+Test the actual file change detection mechanism.
+"""
+import os
+import sys
+import tempfile
+import time
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def test_file_change_detection():
+    """Test the file change detection mechanism."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating project in: {project_path}")
+    
+    # Create project structure
+    project_path.mkdir(parents=True)
+    (project_path / '__init__.py').touch()
+    
+    # Create settings.py with BASE_DIR in TEMPLATES DIRS
+    settings_content = f'''
+import os
+from pathlib import Path
+
+BASE_DIR = Path(__file__).resolve().parent.parent
+SECRET_KEY = 'django-insecure-test-key'
+DEBUG = True
+ALLOWED_HOSTS = []
+INSTALLED_APPS = [
+    'django.contrib.contenttypes',
+    'django.contrib.auth',
+]
+ROOT_URLCONF = 'testproject.urls'
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [BASE_DIR],  # BASE_DIR in DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.request',
+            ],
+        }},
+    }},
+]
+USE_TZ = True
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    (project_path / 'urls.py').write_text('from django.urls import path\nurlpatterns = []')
+    
+    try:
+        # Set up environment
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        import django
+        django.setup()
+        
+        from django.utils.autoreload import StatReloader, autoreload_started
+        from django.template.autoreload import template_changed
+        
+        print(f"\n=== Testing file change detection ===")
+        
+        # Set up the reloader
+        reloader = StatReloader()
+        autoreload_started.send(sender=reloader)
+        
+        # Create a test file in BASE_DIR
+        test_file = project_path / 'test_template.html'
+        test_file.write_text('<html><body>Original content</body></html>')
+        print(f"Created test file: {test_file}")
+        
+        # Get initial snapshot
+        initial_snapshot = dict(reloader.snapshot_files())
+        print(f"Initial snapshot contains {len(initial_snapshot)} files")
+        print(f"Test file in initial snapshot: {test_file in initial_snapshot}")
+        if test_file in initial_snapshot:
+            print(f"Test file initial mtime: {initial_snapshot[test_file]}")
+        
+        # Test template_changed function directly
+        print(f"\n=== Testing template_changed function ===")
+        result = template_changed(None, test_file)
+        print(f"template_changed result: {result}")
+        
+        # Simulate file change
+        time.sleep(0.1)  # Small delay to ensure different mtime
+        test_file.write_text('<html><body>Modified content</body></html>')
+        print(f"Modified test file")
+        
+        # Get new snapshot
+        new_snapshot = dict(reloader.snapshot_files())
+        print(f"Test file in new snapshot: {test_file in new_snapshot}")
+        if test_file in new_snapshot:
+            print(f"Test file new mtime: {new_snapshot[test_file]}")
+            
+            # Check if mtime changed
+            if test_file in initial_snapshot and test_file in new_snapshot:
+                mtime_changed = new_snapshot[test_file] > initial_snapshot[test_file]
+                print(f"Mtime changed: {mtime_changed}")
+                
+                if mtime_changed:
+                    print("✓ File change detected correctly")
+                    return False
+                else:
+                    print("✗ File change NOT detected")
+                    return True
+        
+        print("✗ Test file not found in snapshots")
+        return True
+        
+    finally:
+        import shutil
+        shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    issue_exists = test_file_change_detection()
+    if issue_exists:
+        print("\n✓ Issue reproduced: File change detection not working")
+    else:
+        print("\n✗ File change detection working correctly")
diff --git a/test_manual_project.py b/test_manual_project.py
new file mode 100644
index 0000000000..140b55a1f8
--- /dev/null
+++ b/test_manual_project.py
@@ -0,0 +1,240 @@
+#!/usr/bin/env python
+"""
+Manually create a Django project structure to test the issue.
+"""
+import os
+import sys
+import tempfile
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def create_manual_project():
+    """Manually create a Django project structure."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating manual project in: {project_path}")
+    
+    # Create project directory
+    project_path.mkdir(parents=True)
+    
+    # Create __init__.py
+    (project_path / '__init__.py').touch()
+    
+    # Create settings.py
+    settings_content = f'''
+import os
+from pathlib import Path
+
+# Build paths inside the project like this: BASE_DIR / 'subdir'.
+BASE_DIR = Path(__file__).resolve().parent.parent
+
+# SECURITY WARNING: keep the secret key used in production secret!
+SECRET_KEY = 'django-insecure-test-key'
+
+# SECURITY WARNING: don't run with debug turned on in production!
+DEBUG = True
+
+ALLOWED_HOSTS = []
+
+# Application definition
+INSTALLED_APPS = [
+    'django.contrib.admin',
+    'django.contrib.auth',
+    'django.contrib.contenttypes',
+    'django.contrib.sessions',
+    'django.contrib.messages',
+    'django.contrib.staticfiles',
+]
+
+MIDDLEWARE = [
+    'django.middleware.security.SecurityMiddleware',
+    'django.contrib.sessions.middleware.SessionMiddleware',
+    'django.middleware.common.CommonMiddleware',
+    'django.middleware.csrf.CsrfViewMiddleware',
+    'django.contrib.auth.middleware.AuthenticationMiddleware',
+    'django.contrib.messages.middleware.MessageMiddleware',
+    'django.middleware.clickjacking.XFrameOptionsMiddleware',
+]
+
+ROOT_URLCONF = 'testproject.urls'
+
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [],  # Start with empty DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.debug',
+                'django.template.context_processors.request',
+                'django.contrib.auth.context_processors.auth',
+                'django.contrib.messages.context_processors.messages',
+            ],
+        }},
+    }},
+]
+
+WSGI_APPLICATION = 'testproject.wsgi.application'
+
+# Database
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+
+# Password validation
+AUTH_PASSWORD_VALIDATORS = [
+    {{
+        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
+    }},
+    {{
+        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
+    }},
+    {{
+        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
+    }},
+    {{
+        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
+    }},
+]
+
+# Internationalization
+LANGUAGE_CODE = 'en-us'
+TIME_ZONE = 'UTC'
+USE_I18N = True
+USE_TZ = True
+
+# Static files (CSS, JavaScript, Images)
+STATIC_URL = 'static/'
+
+# Default primary key field type
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    urls_content = '''
+from django.contrib import admin
+from django.urls import path
+
+urlpatterns = [
+    path('admin/', admin.site.urls),
+]
+'''
+    (project_path / 'urls.py').write_text(urls_content)
+    
+    # Create wsgi.py
+    wsgi_content = '''
+import os
+from django.core.wsgi import get_wsgi_application
+
+os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'testproject.settings')
+
+application = get_wsgi_application()
+'''
+    (project_path / 'wsgi.py').write_text(wsgi_content)
+    
+    # Create manage.py
+    manage_content = f'''#!/usr/bin/env python
+import os
+import sys
+
+if __name__ == '__main__':
+    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'testproject.settings')
+    try:
+        from django.core.management import execute_from_command_line
+    except ImportError as exc:
+        raise ImportError(
+            "Couldn't import Django. Are you sure it's installed and "
+            "available on your PYTHONPATH environment variable? Did you "
+            "forget to activate a virtual environment?"
+        ) from exc
+    execute_from_command_line(sys.argv)
+'''
+    manage_file = project_path.parent / 'manage.py'
+    with open(manage_file, 'w') as f:
+        f.write(manage_content)
+    os.chmod(manage_file, 0o755)
+    
+    return project_path, settings_file
+
+def test_issue():
+    """Test the BASE_DIR in TEMPLATES DIRS issue."""
+    project_path, settings_file = create_manual_project()
+    
+    try:
+        # Add project directory to Python path
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        # Test 1: Original settings (empty DIRS)
+        print("\n=== Test 1: Original settings (empty DIRS) ===")
+        
+        import django
+        django.setup()
+        
+        from django.template.autoreload import get_template_directories
+        from django.conf import settings
+        
+        template_dirs_1 = get_template_directories()
+        base_dir = Path(settings.BASE_DIR)
+        
+        print(f"BASE_DIR: {base_dir}")
+        print(f"Template directories: {template_dirs_1}")
+        print(f"BASE_DIR in template_dirs: {base_dir in template_dirs_1}")
+        
+        # Test 2: Add BASE_DIR to DIRS
+        print("\n=== Test 2: Add BASE_DIR to TEMPLATES DIRS ===")
+        
+        # Read and modify settings
+        with open(settings_file, 'r') as f:
+            content = f.read()
+        
+        modified_content = content.replace(
+            "'DIRS': [],",
+            "'DIRS': [BASE_DIR],"
+        )
+        
+        with open(settings_file, 'w') as f:
+            f.write(modified_content)
+        
+        # Reset Django to pick up new settings
+        import importlib
+        import testproject.settings
+        importlib.reload(testproject.settings)
+        
+        # Reset template engines
+        from django.template import engines
+        engines._templates = None
+        engines._engines = {}
+        
+        template_dirs_2 = get_template_directories()
+        print(f"Template directories: {template_dirs_2}")
+        print(f"BASE_DIR in template_dirs: {base_dir in template_dirs_2}")
+        
+        # Check if issue exists
+        issue_exists = base_dir not in template_dirs_2
+        
+        return issue_exists
+        
+    finally:
+        # Cleanup
+        import shutil
+        shutil.rmtree(project_path.parent)
+
+if __name__ == '__main__':
+    issue_exists = test_issue()
+    if issue_exists:
+        print("\n✓ Issue reproduced: BASE_DIR in TEMPLATES DIRS is not being watched")
+    else:
+        print("\n✗ Issue not reproduced: BASE_DIR is correctly being watched")
diff --git a/test_path_behavior.py b/test_path_behavior.py
new file mode 100644
index 0000000000..ec038a1b0d
--- /dev/null
+++ b/test_path_behavior.py
@@ -0,0 +1,51 @@
+#!/usr/bin/env python
+"""
+Test Path behavior with absolute paths.
+"""
+from pathlib import Path
+
+def test_path_behavior():
+    """Test how Path behaves with absolute paths."""
+    
+    # Test case 1: String absolute path
+    abs_path_str = "/tmp/test"
+    cwd = Path.cwd()
+    
+    result1 = cwd / Path(abs_path_str)
+    print(f"cwd / Path('/tmp/test') = {result1}")
+    print(f"exists(): {result1.exists()}")
+    
+    # Test case 2: Path object absolute path
+    abs_path_obj = Path("/tmp/test")
+    result2 = cwd / abs_path_obj
+    print(f"cwd / Path('/tmp/test') = {result2}")
+    print(f"exists(): {result2.exists()}")
+    
+    # Test case 3: What happens with the actual BASE_DIR scenario
+    import tempfile
+    temp_dir = tempfile.mkdtemp()
+    base_dir = Path(temp_dir)
+    
+    print(f"\nBASE_DIR scenario:")
+    print(f"BASE_DIR: {base_dir}")
+    print(f"cwd: {cwd}")
+    print(f"BASE_DIR.is_absolute(): {base_dir.is_absolute()}")
+    
+    result3 = cwd / base_dir
+    print(f"cwd / BASE_DIR = {result3}")
+    print(f"exists(): {result3.exists()}")
+    
+    # Test case 4: What should happen
+    if base_dir.is_absolute():
+        result4 = base_dir
+    else:
+        result4 = cwd / base_dir
+    print(f"Correct result: {result4}")
+    print(f"exists(): {result4.exists()}")
+    
+    # Cleanup
+    import shutil
+    shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    test_path_behavior()
diff --git a/test_performance_issue.py b/test_performance_issue.py
new file mode 100644
index 0000000000..9e105874b8
--- /dev/null
+++ b/test_performance_issue.py
@@ -0,0 +1,175 @@
+#!/usr/bin/env python
+"""
+Test if the issue is related to performance when watching too many files.
+"""
+import os
+import sys
+import tempfile
+import time
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def test_performance_issue():
+    """Test if the issue is performance-related."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating project in: {project_path}")
+    
+    # Create project structure
+    project_path.mkdir(parents=True)
+    (project_path / '__init__.py').touch()
+    
+    # Create many files in BASE_DIR to simulate a real project
+    print("Creating many files in BASE_DIR...")
+    for i in range(100):
+        (project_path / f'file_{i}.py').write_text(f'# File {i}\n')
+        (project_path / f'template_{i}.html').write_text(f'<html>Template {i}</html>')
+    
+    # Create subdirectories with files
+    for subdir in ['static', 'media', 'templates', 'apps']:
+        sub_path = project_path / subdir
+        sub_path.mkdir()
+        for i in range(50):
+            (sub_path / f'file_{i}.txt').write_text(f'Content {i}')
+    
+    # Create settings.py with BASE_DIR in TEMPLATES DIRS
+    settings_content = f'''
+import os
+from pathlib import Path
+
+BASE_DIR = Path(__file__).resolve().parent.parent
+SECRET_KEY = 'django-insecure-test-key'
+DEBUG = True
+ALLOWED_HOSTS = []
+INSTALLED_APPS = [
+    'django.contrib.contenttypes',
+    'django.contrib.auth',
+]
+ROOT_URLCONF = 'testproject.urls'
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [BASE_DIR],  # BASE_DIR in DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.request',
+            ],
+        }},
+    }},
+]
+USE_TZ = True
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    (project_path / 'urls.py').write_text('from django.urls import path\nurlpatterns = []')
+    
+    try:
+        # Set up environment
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        import django
+        django.setup()
+        
+        from django.utils.autoreload import StatReloader, autoreload_started
+        
+        print(f"\n=== Test 1: Without BASE_DIR in TEMPLATES DIRS ===")
+        
+        # Test without BASE_DIR in TEMPLATES DIRS
+        from django.conf import settings
+        settings.TEMPLATES[0]['DIRS'] = []
+        
+        # Reset template engines
+        from django.template import engines
+        engines._templates = None
+        engines._engines = {}
+        
+        reloader1 = StatReloader()
+        
+        start_time = time.time()
+        autoreload_started.send(sender=reloader1)
+        watched_files_1 = list(reloader1.watched_files())
+        end_time = time.time()
+        
+        print(f"Files watched: {len(watched_files_1)}")
+        print(f"Time to collect files: {end_time - start_time:.3f}s")
+        
+        print(f"\n=== Test 2: With BASE_DIR in TEMPLATES DIRS ===")
+        
+        # Test with BASE_DIR in TEMPLATES DIRS
+        settings.TEMPLATES[0]['DIRS'] = [str(settings.BASE_DIR)]
+        
+        # Reset template engines
+        engines._templates = None
+        engines._engines = {}
+        
+        reloader2 = StatReloader()
+        
+        start_time = time.time()
+        autoreload_started.send(sender=reloader2)
+        watched_files_2 = list(reloader2.watched_files())
+        end_time = time.time()
+        
+        print(f"Files watched: {len(watched_files_2)}")
+        print(f"Time to collect files: {end_time - start_time:.3f}s")
+        
+        # Check the difference
+        additional_files = len(watched_files_2) - len(watched_files_1)
+        # time_increase calculation will be done below
+        
+        print(f"\n=== Comparison ===")
+        print(f"Additional files watched: {additional_files}")
+        print(f"Performance impact: Significant if {additional_files} > 200")
+        
+        # Test file snapshot performance
+        print(f"\n=== Testing file snapshot performance ===")
+        
+        start_time = time.time()
+        snapshot_1 = list(reloader1.snapshot_files())
+        end_time = time.time()
+        snapshot_time_1 = end_time - start_time
+        
+        start_time = time.time()
+        snapshot_2 = list(reloader2.snapshot_files())
+        end_time = time.time()
+        snapshot_time_2 = end_time - start_time
+        
+        print(f"Snapshot time without BASE_DIR: {snapshot_time_1:.3f}s")
+        print(f"Snapshot time with BASE_DIR: {snapshot_time_2:.3f}s")
+        print(f"Snapshot time increase: {snapshot_time_2 - snapshot_time_1:.3f}s")
+        
+        # If the snapshot takes too long, it could cause the autoreloader to miss changes
+        if snapshot_time_2 > 0.5:  # If it takes more than 0.5 seconds
+            print("✗ Issue reproduced: File snapshot takes too long with BASE_DIR in TEMPLATES DIRS")
+            return True
+        else:
+            print("✓ File snapshot performance is acceptable")
+            return False
+        
+    finally:
+        import shutil
+        shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    issue_exists = test_performance_issue()
+    if issue_exists:
+        print("\n✓ Performance issue reproduced!")
+    else:
+        print("\n✗ No performance issue found")
diff --git a/test_real_project.py b/test_real_project.py
new file mode 100644
index 0000000000..8b9c9aeebb
--- /dev/null
+++ b/test_real_project.py
@@ -0,0 +1,131 @@
+#!/usr/bin/env python
+"""
+Test with a real Django project structure to reproduce the issue.
+"""
+import os
+import sys
+import tempfile
+import subprocess
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def create_real_project():
+    """Create a real Django project and test the issue."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating test project in: {project_path}")
+    
+    # Create Django project using django-admin from the current Django installation
+    django_admin_script = '/workspace/django__django__4.1/django/bin/django-admin.py'
+    if not os.path.exists(django_admin_script):
+        # Create a simple django-admin script
+        with open(django_admin_script, 'w') as f:
+            f.write('''#!/usr/bin/env python
+import os
+import sys
+import django
+from django.core import management
+
+if __name__ == "__main__":
+    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django.conf.global_settings')
+    django.setup()
+    management.execute_from_command_line()
+''')
+        os.chmod(django_admin_script, 0o755)
+    
+    result = subprocess.run([
+        sys.executable, django_admin_script, 'startproject', project_name
+    ], cwd=temp_dir, capture_output=True, text=True)
+    
+    if result.returncode != 0:
+        print(f"Failed to create project: {result.stderr}")
+        return None, None
+    
+    # Get the settings file
+    settings_file = project_path / project_name / 'settings.py'
+    
+    return project_path, settings_file
+
+def test_with_real_project():
+    """Test the issue with a real Django project."""
+    project_path, settings_file = create_real_project()
+    if not project_path:
+        return False
+    
+    try:
+        print(f"Project created at: {project_path}")
+        
+        # Read original settings
+        with open(settings_file, 'r') as f:
+            original_content = f.read()
+        
+        print("\n=== Test 1: Original settings (empty DIRS) ===")
+        os.chdir(project_path)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        # Import Django and test
+        import django
+        from django.template.autoreload import get_template_directories
+        
+        django.setup()
+        
+        template_dirs_1 = get_template_directories()
+        print(f"Template directories: {template_dirs_1}")
+        
+        # Test 2: Add BASE_DIR to DIRS
+        print("\n=== Test 2: Add BASE_DIR to TEMPLATES DIRS ===")
+        
+        # Modify settings to add BASE_DIR
+        modified_content = original_content.replace(
+            "'DIRS': [],",
+            "'DIRS': [BASE_DIR],"
+        )
+        
+        with open(settings_file, 'w') as f:
+            f.write(modified_content)
+        
+        # Reset Django to pick up new settings
+        from django.utils import autoreload
+        import importlib
+        import testproject.settings
+        importlib.reload(testproject.settings)
+        
+        # Reset template engines
+        from django.template import engines
+        engines._templates = None
+        engines._engines = {}
+        
+        template_dirs_2 = get_template_directories()
+        print(f"Template directories: {template_dirs_2}")
+        
+        # Check if BASE_DIR is in the template directories
+        from django.conf import settings
+        base_dir = Path(settings.BASE_DIR)
+        base_dir_in_template_dirs = base_dir in template_dirs_2
+        
+        print(f"BASE_DIR: {base_dir}")
+        print(f"BASE_DIR in template_dirs: {base_dir_in_template_dirs}")
+        
+        return not base_dir_in_template_dirs  # True if issue exists
+        
+    except Exception as e:
+        print(f"Error: {e}")
+        import traceback
+        traceback.print_exc()
+        return False
+        
+    finally:
+        # Cleanup
+        import shutil
+        shutil.rmtree(project_path.parent)
+
+if __name__ == '__main__':
+    issue_exists = test_with_real_project()
+    if issue_exists:
+        print("\n✓ Issue reproduced!")
+    else:
+        print("\n✗ Issue not reproduced")
diff --git a/test_runserver_simulation.py b/test_runserver_simulation.py
new file mode 100644
index 0000000000..e84e453b50
--- /dev/null
+++ b/test_runserver_simulation.py
@@ -0,0 +1,141 @@
+#!/usr/bin/env python
+"""
+Simulate the runserver behavior to reproduce the issue.
+"""
+import os
+import sys
+import tempfile
+import threading
+import time
+from pathlib import Path
+
+# Add Django to path
+sys.path.insert(0, '/workspace/django__django__4.1')
+
+def test_runserver_simulation():
+    """Test the runserver behavior with BASE_DIR in TEMPLATES DIRS."""
+    temp_dir = tempfile.mkdtemp()
+    project_name = 'testproject'
+    project_path = Path(temp_dir) / project_name
+    
+    print(f"Creating project in: {project_path}")
+    
+    # Create project structure
+    project_path.mkdir(parents=True)
+    (project_path / '__init__.py').touch()
+    
+    # Create settings.py with BASE_DIR in TEMPLATES DIRS
+    settings_content = f'''
+import os
+from pathlib import Path
+
+BASE_DIR = Path(__file__).resolve().parent.parent
+SECRET_KEY = 'django-insecure-test-key'
+DEBUG = True
+ALLOWED_HOSTS = []
+INSTALLED_APPS = [
+    'django.contrib.contenttypes',
+    'django.contrib.auth',
+]
+ROOT_URLCONF = 'testproject.urls'
+DATABASES = {{
+    'default': {{
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': BASE_DIR / 'db.sqlite3',
+    }}
+}}
+TEMPLATES = [
+    {{
+        'BACKEND': 'django.template.backends.django.DjangoTemplates',
+        'DIRS': [BASE_DIR],  # BASE_DIR in DIRS
+        'APP_DIRS': True,
+        'OPTIONS': {{
+            'context_processors': [
+                'django.template.context_processors.request',
+            ],
+        }},
+    }},
+]
+USE_TZ = True
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+'''
+    
+    settings_file = project_path / 'settings.py'
+    with open(settings_file, 'w') as f:
+        f.write(settings_content)
+    
+    # Create urls.py
+    (project_path / 'urls.py').write_text('from django.urls import path\nurlpatterns = []')
+    
+    try:
+        # Set up environment
+        sys.path.insert(0, str(project_path.parent))
+        os.chdir(project_path.parent)
+        os.environ['DJANGO_SETTINGS_MODULE'] = 'testproject.settings'
+        
+        import django
+        django.setup()
+        
+        from django.utils.autoreload import StatReloader, autoreload_started
+        from django.template.autoreload import watch_for_template_changes
+        from unittest.mock import MagicMock
+        
+        print(f"\n=== Simulating autoreloader startup ===")
+        
+        # Create a StatReloader instance (like runserver does)
+        reloader = StatReloader()
+        
+        print(f"Initial reloader state:")
+        print(f"  extra_files: {reloader.extra_files}")
+        print(f"  directory_globs: {reloader.directory_globs}")
+        
+        # Simulate the autoreload_started signal (which calls watch_for_template_changes)
+        print(f"\n=== Sending autoreload_started signal ===")
+        autoreload_started.send(sender=reloader)
+        
+        print(f"After autoreload_started signal:")
+        print(f"  extra_files: {reloader.extra_files}")
+        print(f"  directory_globs: {reloader.directory_globs}")
+        
+        # Test what files would be watched
+        print(f"\n=== Testing watched files ===")
+        watched_files = list(reloader.watched_files())
+        print(f"Number of watched files: {len(watched_files)}")
+        print(f"First 10 watched files: {watched_files[:10]}")
+        
+        # Check if BASE_DIR files are being watched
+        from django.conf import settings
+        base_dir = Path(settings.BASE_DIR)
+        
+        base_dir_files = [f for f in watched_files if base_dir in f.parents or f == base_dir]
+        print(f"Files in BASE_DIR being watched: {len(base_dir_files)}")
+        if base_dir_files:
+            print(f"Sample BASE_DIR files: {base_dir_files[:5]}")
+        
+        # Create a test file in BASE_DIR and see if it gets watched
+        test_file = base_dir / 'test_template.html'
+        test_file.write_text('<html><body>Test</body></html>')
+        print(f"\nCreated test file: {test_file}")
+        
+        # Refresh watched files
+        watched_files_after = list(reloader.watched_files())
+        test_file_watched = test_file in watched_files_after
+        print(f"Test file being watched: {test_file_watched}")
+        
+        if not test_file_watched:
+            print("✗ Issue reproduced: Files in BASE_DIR are not being watched")
+            return True
+        else:
+            print("✓ Files in BASE_DIR are being watched correctly")
+            return False
+        
+    finally:
+        import shutil
+        shutil.rmtree(temp_dir)
+
+if __name__ == '__main__':
+    issue_exists = test_runserver_simulation()
+    if issue_exists:
+        print("\n✓ Issue reproduced!")
+    else:
+        print("\n✗ Issue not reproduced")
--------
2026-01-06 15:32:27,099 - INFO - Using instance container image: docker.io/swebench/sweb.eval.x86_64.matplotlib_1776_matplotlib-24970:latest. Please make sure this image exists. Submit an issue on https://github.com/OpenHands/OpenHands if you run into any issues.
2026-01-06 15:32:27,099 - INFO - Resource mapping for princeton-nlp__SWE-bench_Lite-test not found.
2026-01-06 15:32:27,099 - INFO - Logging LLM completions for instance matplotlib__matplotlib-24970 to ./continuum32/princeton-nlp__SWE-bench_Lite-test/CodeActAgent/GLM-4.6-FP8_maxiter_135/llm_completions/matplotlib__matplotlib-24970
2026-01-06 15:32:27,100 - INFO - Config file not found: config.toml. Error: [Errno 2] No such file or directory: 'config.toml'
2026-01-06 15:32:27,100 - INFO - Config file not found: [Errno 2] No such file or directory: 'config.toml'. Toml values have not been applied.
