2026-01-06 15:24:05,183 - INFO - [LLM registry 44ef9dd3-9156-4e4e-8fa3-36284c8db280]: Registering service for agent
2026-01-06 15:24:05,219 - INFO - Building image: ghcr.io/openhands/runtime:oh_v1.0.0_13frn7hjw2rn4452_v008aov5t6vw3gr5
2026-01-06 15:31:17,054 - INFO - Image [ghcr.io/openhands/runtime:oh_v1.0.0_13frn7hjw2rn4452_v008aov5t6vw3gr5] build finished.
2026-01-06 15:31:17,066 - INFO - Re-tagged image [ghcr.io/openhands/runtime:oh_v1.0.0_13frn7hjw2rn4452_v008aov5t6vw3gr5] with more generic tag [oh_v1.0.0_13frn7hjw2rn4452]
2026-01-06 15:31:17,069 - INFO - Image ghcr.io/openhands/runtime with tags [oh_v1.0.0_13frn7hjw2rn4452_v008aov5t6vw3gr5, oh_v1.0.0_13frn7hjw2rn4452] built successfully
2026-01-06 15:31:17,163 - INFO - [runtime 2bf21d85-b6b1-47-06ab1cb58a6ffe2] Starting runtime with image: ghcr.io/openhands/runtime:oh_v1.0.0_13frn7hjw2rn4452_v008aov5t6vw3gr5
2026-01-06 15:31:17,264 - INFO - [runtime 2bf21d85-b6b1-47-06ab1cb58a6ffe2] Starting server with command: ['/openhands/micromamba/bin/micromamba', 'run', '-n', 'openhands', 'poetry', 'run', 'python', '-u', '-m', 'openhands.runtime.action_execution_server', '37880', '--working-dir', '/workspace', '--plugins', 'agent_skills', 'jupyter', '--username', 'root', '--user-id', '0', '--no-enable-browser']
2026-01-06 15:31:22,080 - INFO - [runtime 2bf21d85-b6b1-47-06ab1cb58a6ffe2] Container started: openhands-runtime-2bf21d85-b6b1-47-06ab1cb58a6ffe2. VSCode URL: None
2026-01-06 15:31:22,080 - INFO - [runtime 2bf21d85-b6b1-47-06ab1cb58a6ffe2] Waiting for client to become ready at http://localhost:37880...
2026-01-06 15:32:00,198 - INFO - [runtime 2bf21d85-b6b1-47-06ab1cb58a6ffe2] Runtime is ready.
2026-01-06 15:32:03,319 - INFO - Successfully configured git: name=openhands, email=openhands@all-hands.dev
2026-01-06 15:32:03,320 - INFO - ------------------------------
2026-01-06 15:32:03,321 - INFO - BEGIN Runtime Initialization Fn
2026-01-06 15:32:03,321 - INFO - ------------------------------
2026-01-06 15:32:03,321 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
echo 'export SWE_INSTANCE_ID=django__django-16595' >> ~/.bashrc && echo 'export PIP_CACHE_DIR=~/.cache/pip' >> ~/.bashrc && echo "alias git='git --no-pager'" >> ~/.bashrc && git config --global core.pager "" && git config --global diff.binary false
2026-01-06 15:32:03,942 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:03,943 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
export USER=$(whoami); echo USER=${USER} 
2026-01-06 15:32:04,576 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
USER=root
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:04,576 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
mkdir -p /swe_util/eval_data/instances
2026-01-06 15:32:05,195 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:05,201 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cat ~/.bashrc
2026-01-06 15:32:05,820 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
source /opt/miniconda3/etc/profile.d/conda.sh && conda activate testbed

. "/openhands/bin/env"
export PATH="/usr/bin:/bin:/usr/sbin:/sbin:/openhands/micromamba/bin:$PATH"
export PLAYWRIGHT_BROWSERS_PATH=/opt/playwright-browsers
eval "$(/openhands/micromamba/bin/micromamba shell hook --shell bash)"
micromamba activate openhands 2>/dev/null || true
export ENABLE_AUTO_LINT=true
export NO_CHANGE_TIMEOUT_SECONDS=30
export OPENHANDS_EVAL_INSTANCE_ID=django__django-16595
export OPENHANDS_EVAL_JOB_ID=3544828247
export OPENHANDS_TIMING_DIR=./continuum32/princeton-nlp__SWE-bench_Lite-test/CodeActAgent/GLM-4.6-FP8_maxiter_135/timing
export SWE_INSTANCE_ID=django__django-16595
export PIP_CACHE_DIR=~/.cache/pip
alias git='git --no-pager'
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:05,821 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
source ~/.bashrc
2026-01-06 15:32:06,439 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:06,439 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
source /swe_util/instance_swe_entry.sh
2026-01-06 15:32:07,561 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
WORKSPACE_NAME: django__django__5.0
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:07,561 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cd /workspace/django__django__5.0
2026-01-06 15:32:08,185 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace/django__django__5.0",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__5.0]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:08,186 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git reset --hard
2026-01-06 15:32:10,815 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace/django__django__5.0",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
Updating files: 100% (6654/6654), done.
HEAD is now at 5a875de3c0 SWE-bench
[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__5.0]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:10,817 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
for remote_name in $(git remote); do git remote remove "${remote_name}"; done
2026-01-06 15:32:11,435 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace/django__django__5.0",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__5.0]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:11,436 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
which python
2026-01-06 15:32:12,058 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace/django__django__5.0",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
/opt/miniconda3/envs/testbed/bin/python
[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__5.0]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:32:12,059 - INFO - ------------------------------
2026-01-06 15:32:12,059 - INFO - END Runtime Initialization Fn
2026-01-06 15:32:12,060 - INFO - ------------------------------
2026-01-06 15:32:12,062 - INFO - [LLM registry 4d29f0e3-ee23-4a31-b923-660339e14ddb]: Registering service for agent
2026-01-06 15:32:12,075 - INFO - [runtime 2bf21d85-b6b1-47-06ab1cb58a6ffe2] Selected repo: None, loading microagents from /workspace/.openhands/microagents (inside runtime)
2026-01-06 15:32:12,077 - INFO - [runtime 2bf21d85-b6b1-47-06ab1cb58a6ffe2] Attempting to list files in repository microagents directory: /workspace/.openhands/microagents
2026-01-06 15:32:12,081 - INFO - Loading user workspace microagents: []
2026-01-06 15:32:12,081 - INFO - AgentController 2bf21d85-b6b1-47-06ab1cb58a6ffe2 - created new state. start_id: 0
2026-01-06 15:32:12,087 - INFO - [Agent Controller 2bf21d85-b6b1-47-06ab1cb58a6ffe2] Setting agent(CodeActAgent) state from AgentState.LOADING to AgentState.RUNNING
2026-01-06 15:32:12,094 - INFO - Saved conversation stats
2026-01-06 15:40:33,336 - INFO - [Agent Controller 2bf21d85-b6b1-47-06ab1cb58a6ffe2] Setting agent(CodeActAgent) state from AgentState.RUNNING to AgentState.FINISHED
2026-01-06 15:40:33,338 - INFO - Saved conversation stats
2026-01-06 15:40:33,765 - INFO - ------------------------------
2026-01-06 15:40:33,766 - INFO - BEGIN Runtime Completion Fn
2026-01-06 15:40:33,766 - INFO - ------------------------------
2026-01-06 15:40:33,766 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cd /workspace/django__django__5.0
2026-01-06 15:40:34,392 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace/django__django__5.0",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__5.0]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:40:34,393 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git config --global core.pager ""
2026-01-06 15:40:35,013 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace/django__django__5.0",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__5.0]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:40:35,014 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
find . -type d -name .git -not -path "./.git"
2026-01-06 15:40:35,632 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace/django__django__5.0",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__5.0]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:40:35,633 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git add -A
2026-01-06 15:40:36,253 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace/django__django__5.0",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__5.0]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:40:36,253 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
for file in $(git status --porcelain | grep -E "^(M| M|\?\?|A| A)" | cut -c4-); do
        if [ -f "$file" ] && (file "$file" | grep -q "executable" || git check-attr binary "$file" | grep -q "binary: set"); then
            git rm -f "$file" 2>/dev/null || rm -f "$file"
            echo "Removed: $file"
        fi
    done
2026-01-06 15:40:36,937 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace/django__django__5.0",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
bash: file: command not found
bash: file: command not found
bash: file: command not found
bash: file: command not found
bash: file: command not found
bash: file: command not found
[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__5.0]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:40:36,937 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git diff --no-color --cached f9fe062de5fc0896d6bbbf3f260b5c44473b3c77 > patch.diff
2026-01-06 15:40:37,557 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "39b79bffe44b",
  "working_dir": "/workspace/django__django__5.0",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/django__django__5.0]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:40:37,558 - INFO - FileReadAction(path='patch.diff', start=0, end=-1, thought='', action=<ActionType.READ: 'read'>, security_risk=<ActionSecurityRisk.UNKNOWN: -1>, impl_source=<FileReadSource.DEFAULT: 'default'>, view_range=None)
2026-01-06 15:40:37,561 - INFO - [Read from /workspace/django__django__5.0/patch.diff is successful.]
diff --git a/debug_optimizer.py b/debug_optimizer.py
new file mode 100644
index 0000000000..fe3274b196
--- /dev/null
+++ b/debug_optimizer.py
@@ -0,0 +1,67 @@
+#!/usr/bin/env python3
+"""
+Debug script to understand why the optimizer isn't working as expected.
+"""
+
+import os
+import sys
+import django
+from django.conf import settings
+
+# Configure Django settings
+if not settings.configured:
+    settings.configure(
+        DEBUG=True,
+        DATABASES={
+            'default': {
+                'ENGINE': 'django.db.backends.sqlite3',
+                'NAME': ':memory:',
+            }
+        },
+        INSTALLED_APPS=[
+            'django.contrib.contenttypes',
+            'django.contrib.auth',
+        ],
+        SECRET_KEY='test-secret-key',
+    )
+    django.setup()
+
+from django.db import migrations, models
+from django.db.migrations.optimizer import MigrationOptimizer
+from django.db.migrations.serializer import serializer_factory
+
+def debug_optimizer():
+    """Debug the optimizer behavior."""
+    
+    operations = [
+        migrations.AlterField("Foo", "age", models.IntegerField()),
+        migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+    ]
+    
+    print("=== Debugging Optimizer ===")
+    print("Input operations:")
+    for i, op in enumerate(operations):
+        print(f"  {i+1}. {op}")
+    
+    optimizer = MigrationOptimizer()
+    
+    # Test individual reduce calls
+    print(f"\nTesting reduce operation:")
+    result = operations[0].reduce(operations[1], "testapp")
+    print(f"operations[0].reduce(operations[1]) = {result}")
+    
+    # Test full optimization
+    print(f"\nTesting full optimization:")
+    result = optimizer.optimize(operations, "testapp")
+    print(f"optimizer.optimize() result: {len(result)} operations")
+    for i, op in enumerate(result):
+        print(f"  {i+1}. {op}")
+    
+    # Test serialization
+    print(f"\nTesting serialization:")
+    serialized_result = [serializer_factory(f).serialize()[0] for f in result]
+    for i, s in enumerate(serialized_result):
+        print(f"  {i+1}. {s}")
+
+if __name__ == "__main__":
+    debug_optimizer()
\ No newline at end of file
diff --git a/debug_test.py b/debug_test.py
new file mode 100644
index 0000000000..9d1fb3860c
--- /dev/null
+++ b/debug_test.py
@@ -0,0 +1,92 @@
+#!/usr/bin/env python3
+"""
+Debug the specific test case that's failing.
+"""
+
+import os
+import sys
+import django
+from django.conf import settings
+
+# Configure Django settings
+if not settings.configured:
+    settings.configure(
+        DEBUG=True,
+        DATABASES={
+            'default': {
+                'ENGINE': 'django.db.backends.sqlite3',
+                'NAME': ':memory:',
+            }
+        },
+        INSTALLED_APPS=[
+            'django.contrib.contenttypes',
+            'django.contrib.auth',
+        ],
+        SECRET_KEY='test-secret-key',
+    )
+    django.setup()
+
+from django.db import migrations, models
+from django.db.migrations.optimizer import MigrationOptimizer
+from django.db.migrations.serializer import serializer_factory
+from django.test import SimpleTestCase
+
+class DebugTest(SimpleTestCase):
+    def optimize(self, operations, app_label):
+        """
+        Handy shortcut for getting results + number of loops
+        """
+        optimizer = MigrationOptimizer()
+        return optimizer.optimize(operations, app_label), optimizer._iterations
+
+    def serialize(self, value):
+        return serializer_factory(value).serialize()[0]
+
+    def assertOptimizesTo(
+        self, operations, expected, exact=None, less_than=None, app_label=None
+    ):
+        result, iterations = self.optimize(operations, app_label or "migrations")
+        result = [self.serialize(f) for f in result]
+        expected = [self.serialize(f) for f in expected]
+        
+        print("=== DEBUG ASSERTOPTIMIZESTO ===")
+        print(f"Input operations ({len(operations)}):")
+        for i, op in enumerate(operations):
+            print(f"  {i+1}. {op}")
+        
+        print(f"\nExpected result ({len(expected)}):")
+        for i, exp in enumerate(expected):
+            print(f"  {i+1}. {exp}")
+        
+        print(f"\nActual result ({len(result)}):")
+        for i, res in enumerate(result):
+            print(f"  {i+1}. {res}")
+        
+        print(f"\nEqual? {expected == result}")
+        if expected != result:
+            print("Differences:")
+            for i, (exp, res) in enumerate(zip(expected, result)):
+                if exp != res:
+                    print(f"  Position {i}:")
+                    print(f"    Expected: {exp}")
+                    print(f"    Actual:   {res}")
+        
+        self.assertEqual(expected, result)
+
+    def test_alter_field_alter_field_debug(self):
+        """
+        Debug version of the failing test.
+        """
+        operations = [
+            migrations.AlterField("Foo", "age", models.IntegerField()),
+            migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+        ]
+        expected = [
+            migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+        ]
+        
+        self.assertOptimizesTo(operations, expected)
+
+if __name__ == "__main__":
+    import unittest
+    unittest.main()
\ No newline at end of file
diff --git a/django/db/migrations/operations/fields.py b/django/db/migrations/operations/fields.py
index cd3aab43ad..0b73723fd1 100644
--- a/django/db/migrations/operations/fields.py
+++ b/django/db/migrations/operations/fields.py
@@ -247,6 +247,10 @@ class AlterField(FieldOperation):
         return "alter_%s_%s" % (self.model_name_lower, self.name_lower)
 
     def reduce(self, operation, app_label):
+        if isinstance(operation, AlterField) and self.is_same_field_operation(
+            operation
+        ):
+            return [operation]
         if isinstance(operation, RemoveField) and self.is_same_field_operation(
             operation
         ):
diff --git a/reproduce_issue.py b/reproduce_issue.py
new file mode 100644
index 0000000000..4b6cf3ebb2
--- /dev/null
+++ b/reproduce_issue.py
@@ -0,0 +1,155 @@
+#!/usr/bin/env python3
+"""
+Reproduction script for the migration optimizer issue with multiple AlterField operations.
+
+The issue: Migration optimizer does not reduce multiple AlterField operations
+when they are separated from the initial AddField operation.
+"""
+
+import os
+import sys
+import django
+from django.conf import settings
+
+# Configure Django settings
+if not settings.configured:
+    settings.configure(
+        DEBUG=True,
+        DATABASES={
+            'default': {
+                'ENGINE': 'django.db.backends.sqlite3',
+                'NAME': ':memory:',
+            }
+        },
+        INSTALLED_APPS=[
+            'django.contrib.contenttypes',
+            'django.contrib.auth',
+        ],
+        SECRET_KEY='test-secret-key',
+    )
+    django.setup()
+
+from django.db import migrations, models
+from django.db.migrations.optimizer import MigrationOptimizer
+
+def test_issue_reproduction():
+    """Test case that reproduces the issue described in the bug report."""
+    
+    print("=== Testing Migration Optimizer Issue ===")
+    
+    # Create the operations as described in the issue
+    operations = [
+        migrations.AddField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=256, null=True),
+        ),
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True),
+        ),
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True, help_text="help"),
+        ),
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True, help_text="help", default=None),
+        ),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    
+    # Test 1: Full sequence (should work correctly)
+    print("\n1. Testing full sequence (AddField + AlterField operations):")
+    print(f"   Input operations: {len(operations)}")
+    for i, op in enumerate(operations):
+        print(f"   {i+1}. {op.__class__.__name__} - {op.model_name}.{op.name}")
+    
+    result_full = optimizer.optimize(operations, "books")
+    print(f"   Output operations: {len(result_full)}")
+    for i, op in enumerate(result_full):
+        print(f"   {i+1}. {op.__class__.__name__} - {op.model_name}.{op.name}")
+    
+    # Test 2: Only AlterField operations (this is where the bug occurs)
+    print("\n2. Testing only AlterField operations (simulating separation from AddField):")
+    alter_operations = operations[1:]  # Skip the AddField
+    print(f"   Input operations: {len(alter_operations)}")
+    for i, op in enumerate(alter_operations):
+        print(f"   {i+1}. {op.__class__.__name__} - {op.model_name}.{op.name}")
+    
+    result_alter_only = optimizer.optimize(alter_operations, "books")
+    print(f"   Output operations: {len(result_alter_only)}")
+    for i, op in enumerate(result_alter_only):
+        print(f"   {i+1}. {op.__class__.__name__} - {op.model_name}.{op.name}")
+    
+    # Analysis
+    print("\n=== Analysis ===")
+    print(f"Full sequence optimization: {'‚úì PASS' if len(result_full) == 1 else '‚úó FAIL'}")
+    print(f"AlterField-only optimization: {'‚úì PASS' if len(result_alter_only) == 1 else '‚úó FAIL'}")
+    
+    if len(result_alter_only) > 1:
+        print("\nüêõ BUG CONFIRMED: Multiple AlterField operations are not being reduced!")
+        print("   Expected: 1 operation (the last AlterField)")
+        print(f"   Actual: {len(result_alter_only)} operations")
+        return False
+    else:
+        print("\n‚úÖ No bug detected - AlterField operations are being reduced correctly.")
+        return True
+
+def test_expected_behavior():
+    """Test what the expected behavior should be."""
+    print("\n=== Expected Behavior Test ===")
+    
+    # Multiple AlterField operations on the same field should reduce to the last one
+    operations = [
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True),
+        ),
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True, help_text="help"),
+        ),
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True, help_text="help", default=None),
+        ),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} AlterField operations")
+    print(f"Output: {len(result)} operations")
+    
+    if len(result) == 1:
+        print("‚úÖ Expected behavior: Multiple AlterField operations reduced to one")
+        return True
+    else:
+        print("üêõ Bug: Multiple AlterField operations should be reduced to one")
+        return False
+
+if __name__ == "__main__":
+    print("Django Migration Optimizer Issue Reproduction")
+    print("=" * 50)
+    
+    # Test the main issue
+    issue_reproduced = not test_issue_reproduction()
+    
+    # Test expected behavior
+    expected_behavior_works = test_expected_behavior()
+    
+    print("\n" + "=" * 50)
+    if issue_reproduced:
+        print("üêõ ISSUE REPRODUCED: Migration optimizer does not reduce multiple AlterField operations")
+        sys.exit(1)
+    else:
+        print("‚úÖ NO ISSUE: Migration optimizer works correctly")
+        sys.exit(0)
\ No newline at end of file
diff --git a/test_comprehensive.py b/test_comprehensive.py
new file mode 100644
index 0000000000..1f31f6fe3f
--- /dev/null
+++ b/test_comprehensive.py
@@ -0,0 +1,204 @@
+#!/usr/bin/env python3
+"""
+Comprehensive test for the AlterField optimization fix.
+Tests various edge cases and scenarios.
+"""
+
+import os
+import sys
+import django
+from django.conf import settings
+
+# Configure Django settings
+if not settings.configured:
+    settings.configure(
+        DEBUG=True,
+        DATABASES={
+            'default': {
+                'ENGINE': 'django.db.backends.sqlite3',
+                'NAME': ':memory:',
+            }
+        },
+        INSTALLED_APPS=[
+            'django.contrib.contenttypes',
+            'django.contrib.auth',
+        ],
+        SECRET_KEY='test-secret-key',
+    )
+    django.setup()
+
+from django.db import migrations, models
+from django.db.migrations.optimizer import MigrationOptimizer
+
+def test_multiple_alter_field_reduction():
+    """Test that multiple AlterField operations reduce to one."""
+    print("=== Test: Multiple AlterField Reduction ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=256, null=True)),
+        migrations.AlterField("book", "title", models.CharField(max_length=128, null=True)),
+        migrations.AlterField("book", "title", models.CharField(max_length=128, null=True, help_text="help")),
+        migrations.AlterField("book", "title", models.CharField(max_length=128, null=True, help_text="help", default=None)),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    success = len(result) == 1
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    if success:
+        final_field = result[0].field
+        print(f"Final field: max_length={final_field.max_length}, null={final_field.null}, help_text='{final_field.help_text}', default={final_field.default}")
+    
+    return success
+
+def test_different_fields_not_reduced():
+    """Test that AlterField operations on different fields are not reduced."""
+    print("\n=== Test: Different Fields Not Reduced ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=128)),
+        migrations.AlterField("book", "author", models.CharField(max_length=256)),
+        migrations.AlterField("book", "title", models.CharField(max_length=64)),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    # Should reduce the two title operations but keep the author operation
+    success = len(result) == 2
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    return success
+
+def test_different_models_not_reduced():
+    """Test that AlterField operations on different models are not reduced."""
+    print("\n=== Test: Different Models Not Reduced ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=128)),
+        migrations.AlterField("author", "name", models.CharField(max_length=256)),
+        migrations.AlterField("book", "title", models.CharField(max_length=64)),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    # Should reduce the two book.title operations but keep the author.name operation
+    success = len(result) == 2
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    return success
+
+def test_alter_field_with_remove_field():
+    """Test that AlterField followed by RemoveField reduces correctly."""
+    print("\n=== Test: AlterField with RemoveField ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=128)),
+        migrations.AlterField("book", "title", models.CharField(max_length=64)),
+        migrations.RemoveField("book", "title"),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    # Should reduce to just the RemoveField
+    success = len(result) == 1 and isinstance(result[0], migrations.RemoveField)
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    return success
+
+def test_alter_field_with_rename_field():
+    """Test that AlterField with RenameField works correctly."""
+    print("\n=== Test: AlterField with RenameField ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=128)),
+        migrations.AlterField("book", "title", models.CharField(max_length=64)),
+        migrations.RenameField("book", "title", "name"),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    # Should reduce to one AlterField (the last one) and the RenameField
+    success = len(result) == 2
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    return success
+
+def test_single_alter_field():
+    """Test that a single AlterField operation is not changed."""
+    print("\n=== Test: Single AlterField ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=128)),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    success = len(result) == 1
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    return success
+
+def run_all_tests():
+    """Run all comprehensive tests."""
+    print("Comprehensive AlterField Optimization Tests")
+    print("=" * 50)
+    
+    tests = [
+        test_multiple_alter_field_reduction,
+        test_different_fields_not_reduced,
+        test_different_models_not_reduced,
+        test_alter_field_with_remove_field,
+        test_alter_field_with_rename_field,
+        test_single_alter_field,
+    ]
+    
+    results = []
+    for test in tests:
+        try:
+            result = test()
+            results.append(result)
+        except Exception as e:
+            print(f"‚ùå ERROR in {test.__name__}: {e}")
+            results.append(False)
+    
+    print("\n" + "=" * 50)
+    print("Test Summary:")
+    passed = sum(results)
+    total = len(results)
+    print(f"Passed: {passed}/{total}")
+    
+    if passed == total:
+        print("üéâ All tests passed!")
+        return True
+    else:
+        print("‚ùå Some tests failed!")
+        return False
+
+if __name__ == "__main__":
+    success = run_all_tests()
+    sys.exit(0 if success else 1)
\ No newline at end of file
diff --git a/tests/migrations/test_optimizer.py b/tests/migrations/test_optimizer.py
index 6485009eb4..ee8f2aacfe 100644
--- a/tests/migrations/test_optimizer.py
+++ b/tests/migrations/test_optimizer.py
@@ -822,6 +822,32 @@ class OptimizerTests(SimpleTestCase):
             ],
         )
 
+    def test_alter_field_alter_field(self):
+        """
+        Multiple AlterField operations on the same field should reduce to the last one.
+        """
+        # Test with two operations first
+        self.assertOptimizesTo(
+            [
+                migrations.AlterField("Foo", "age", models.IntegerField()),
+                migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+            ],
+            [
+                migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+            ],
+        )
+        # Test with three operations - should reduce to the last one after multiple passes
+        self.assertOptimizesTo(
+            [
+                migrations.AlterField("Foo", "age", models.IntegerField()),
+                migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+                migrations.AlterField("Foo", "age", models.FloatField(default=3.14, help_text="help")),
+            ],
+            [
+                migrations.AlterField("Foo", "age", models.FloatField(default=3.14, help_text="help")),
+            ],
+        )
+
     def _test_create_alter_foo_field(self, alter):
         """
         CreateModel, AlterFooTogether/AlterOrderWithRespectTo followed by an

2026-01-06 15:40:37,562 - INFO - ------------------------------
2026-01-06 15:40:37,562 - INFO - END Runtime Completion Fn
2026-01-06 15:40:37,562 - INFO - ------------------------------
2026-01-06 15:40:37,562 - INFO - Got git diff for instance django__django-16595:
--------
diff --git a/debug_optimizer.py b/debug_optimizer.py
new file mode 100644
index 0000000000..fe3274b196
--- /dev/null
+++ b/debug_optimizer.py
@@ -0,0 +1,67 @@
+#!/usr/bin/env python3
+"""
+Debug script to understand why the optimizer isn't working as expected.
+"""
+
+import os
+import sys
+import django
+from django.conf import settings
+
+# Configure Django settings
+if not settings.configured:
+    settings.configure(
+        DEBUG=True,
+        DATABASES={
+            'default': {
+                'ENGINE': 'django.db.backends.sqlite3',
+                'NAME': ':memory:',
+            }
+        },
+        INSTALLED_APPS=[
+            'django.contrib.contenttypes',
+            'django.contrib.auth',
+        ],
+        SECRET_KEY='test-secret-key',
+    )
+    django.setup()
+
+from django.db import migrations, models
+from django.db.migrations.optimizer import MigrationOptimizer
+from django.db.migrations.serializer import serializer_factory
+
+def debug_optimizer():
+    """Debug the optimizer behavior."""
+    
+    operations = [
+        migrations.AlterField("Foo", "age", models.IntegerField()),
+        migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+    ]
+    
+    print("=== Debugging Optimizer ===")
+    print("Input operations:")
+    for i, op in enumerate(operations):
+        print(f"  {i+1}. {op}")
+    
+    optimizer = MigrationOptimizer()
+    
+    # Test individual reduce calls
+    print(f"\nTesting reduce operation:")
+    result = operations[0].reduce(operations[1], "testapp")
+    print(f"operations[0].reduce(operations[1]) = {result}")
+    
+    # Test full optimization
+    print(f"\nTesting full optimization:")
+    result = optimizer.optimize(operations, "testapp")
+    print(f"optimizer.optimize() result: {len(result)} operations")
+    for i, op in enumerate(result):
+        print(f"  {i+1}. {op}")
+    
+    # Test serialization
+    print(f"\nTesting serialization:")
+    serialized_result = [serializer_factory(f).serialize()[0] for f in result]
+    for i, s in enumerate(serialized_result):
+        print(f"  {i+1}. {s}")
+
+if __name__ == "__main__":
+    debug_optimizer()
\ No newline at end of file
diff --git a/debug_test.py b/debug_test.py
new file mode 100644
index 0000000000..9d1fb3860c
--- /dev/null
+++ b/debug_test.py
@@ -0,0 +1,92 @@
+#!/usr/bin/env python3
+"""
+Debug the specific test case that's failing.
+"""
+
+import os
+import sys
+import django
+from django.conf import settings
+
+# Configure Django settings
+if not settings.configured:
+    settings.configure(
+        DEBUG=True,
+        DATABASES={
+            'default': {
+                'ENGINE': 'django.db.backends.sqlite3',
+                'NAME': ':memory:',
+            }
+        },
+        INSTALLED_APPS=[
+            'django.contrib.contenttypes',
+            'django.contrib.auth',
+        ],
+        SECRET_KEY='test-secret-key',
+    )
+    django.setup()
+
+from django.db import migrations, models
+from django.db.migrations.optimizer import MigrationOptimizer
+from django.db.migrations.serializer import serializer_factory
+from django.test import SimpleTestCase
+
+class DebugTest(SimpleTestCase):
+    def optimize(self, operations, app_label):
+        """
+        Handy shortcut for getting results + number of loops
+        """
+        optimizer = MigrationOptimizer()
+        return optimizer.optimize(operations, app_label), optimizer._iterations
+
+    def serialize(self, value):
+        return serializer_factory(value).serialize()[0]
+
+    def assertOptimizesTo(
+        self, operations, expected, exact=None, less_than=None, app_label=None
+    ):
+        result, iterations = self.optimize(operations, app_label or "migrations")
+        result = [self.serialize(f) for f in result]
+        expected = [self.serialize(f) for f in expected]
+        
+        print("=== DEBUG ASSERTOPTIMIZESTO ===")
+        print(f"Input operations ({len(operations)}):")
+        for i, op in enumerate(operations):
+            print(f"  {i+1}. {op}")
+        
+        print(f"\nExpected result ({len(expected)}):")
+        for i, exp in enumerate(expected):
+            print(f"  {i+1}. {exp}")
+        
+        print(f"\nActual result ({len(result)}):")
+        for i, res in enumerate(result):
+            print(f"  {i+1}. {res}")
+        
+        print(f"\nEqual? {expected == result}")
+        if expected != result:
+            print("Differences:")
+            for i, (exp, res) in enumerate(zip(expected, result)):
+                if exp != res:
+                    print(f"  Position {i}:")
+                    print(f"    Expected: {exp}")
+                    print(f"    Actual:   {res}")
+        
+        self.assertEqual(expected, result)
+
+    def test_alter_field_alter_field_debug(self):
+        """
+        Debug version of the failing test.
+        """
+        operations = [
+            migrations.AlterField("Foo", "age", models.IntegerField()),
+            migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+        ]
+        expected = [
+            migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+        ]
+        
+        self.assertOptimizesTo(operations, expected)
+
+if __name__ == "__main__":
+    import unittest
+    unittest.main()
\ No newline at end of file
diff --git a/django/db/migrations/operations/fields.py b/django/db/migrations/operations/fields.py
index cd3aab43ad..0b73723fd1 100644
--- a/django/db/migrations/operations/fields.py
+++ b/django/db/migrations/operations/fields.py
@@ -247,6 +247,10 @@ class AlterField(FieldOperation):
         return "alter_%s_%s" % (self.model_name_lower, self.name_lower)
 
     def reduce(self, operation, app_label):
+        if isinstance(operation, AlterField) and self.is_same_field_operation(
+            operation
+        ):
+            return [operation]
         if isinstance(operation, RemoveField) and self.is_same_field_operation(
             operation
         ):
diff --git a/reproduce_issue.py b/reproduce_issue.py
new file mode 100644
index 0000000000..4b6cf3ebb2
--- /dev/null
+++ b/reproduce_issue.py
@@ -0,0 +1,155 @@
+#!/usr/bin/env python3
+"""
+Reproduction script for the migration optimizer issue with multiple AlterField operations.
+
+The issue: Migration optimizer does not reduce multiple AlterField operations
+when they are separated from the initial AddField operation.
+"""
+
+import os
+import sys
+import django
+from django.conf import settings
+
+# Configure Django settings
+if not settings.configured:
+    settings.configure(
+        DEBUG=True,
+        DATABASES={
+            'default': {
+                'ENGINE': 'django.db.backends.sqlite3',
+                'NAME': ':memory:',
+            }
+        },
+        INSTALLED_APPS=[
+            'django.contrib.contenttypes',
+            'django.contrib.auth',
+        ],
+        SECRET_KEY='test-secret-key',
+    )
+    django.setup()
+
+from django.db import migrations, models
+from django.db.migrations.optimizer import MigrationOptimizer
+
+def test_issue_reproduction():
+    """Test case that reproduces the issue described in the bug report."""
+    
+    print("=== Testing Migration Optimizer Issue ===")
+    
+    # Create the operations as described in the issue
+    operations = [
+        migrations.AddField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=256, null=True),
+        ),
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True),
+        ),
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True, help_text="help"),
+        ),
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True, help_text="help", default=None),
+        ),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    
+    # Test 1: Full sequence (should work correctly)
+    print("\n1. Testing full sequence (AddField + AlterField operations):")
+    print(f"   Input operations: {len(operations)}")
+    for i, op in enumerate(operations):
+        print(f"   {i+1}. {op.__class__.__name__} - {op.model_name}.{op.name}")
+    
+    result_full = optimizer.optimize(operations, "books")
+    print(f"   Output operations: {len(result_full)}")
+    for i, op in enumerate(result_full):
+        print(f"   {i+1}. {op.__class__.__name__} - {op.model_name}.{op.name}")
+    
+    # Test 2: Only AlterField operations (this is where the bug occurs)
+    print("\n2. Testing only AlterField operations (simulating separation from AddField):")
+    alter_operations = operations[1:]  # Skip the AddField
+    print(f"   Input operations: {len(alter_operations)}")
+    for i, op in enumerate(alter_operations):
+        print(f"   {i+1}. {op.__class__.__name__} - {op.model_name}.{op.name}")
+    
+    result_alter_only = optimizer.optimize(alter_operations, "books")
+    print(f"   Output operations: {len(result_alter_only)}")
+    for i, op in enumerate(result_alter_only):
+        print(f"   {i+1}. {op.__class__.__name__} - {op.model_name}.{op.name}")
+    
+    # Analysis
+    print("\n=== Analysis ===")
+    print(f"Full sequence optimization: {'‚úì PASS' if len(result_full) == 1 else '‚úó FAIL'}")
+    print(f"AlterField-only optimization: {'‚úì PASS' if len(result_alter_only) == 1 else '‚úó FAIL'}")
+    
+    if len(result_alter_only) > 1:
+        print("\nüêõ BUG CONFIRMED: Multiple AlterField operations are not being reduced!")
+        print("   Expected: 1 operation (the last AlterField)")
+        print(f"   Actual: {len(result_alter_only)} operations")
+        return False
+    else:
+        print("\n‚úÖ No bug detected - AlterField operations are being reduced correctly.")
+        return True
+
+def test_expected_behavior():
+    """Test what the expected behavior should be."""
+    print("\n=== Expected Behavior Test ===")
+    
+    # Multiple AlterField operations on the same field should reduce to the last one
+    operations = [
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True),
+        ),
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True, help_text="help"),
+        ),
+        migrations.AlterField(
+            model_name="book",
+            name="title",
+            field=models.CharField(max_length=128, null=True, help_text="help", default=None),
+        ),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} AlterField operations")
+    print(f"Output: {len(result)} operations")
+    
+    if len(result) == 1:
+        print("‚úÖ Expected behavior: Multiple AlterField operations reduced to one")
+        return True
+    else:
+        print("üêõ Bug: Multiple AlterField operations should be reduced to one")
+        return False
+
+if __name__ == "__main__":
+    print("Django Migration Optimizer Issue Reproduction")
+    print("=" * 50)
+    
+    # Test the main issue
+    issue_reproduced = not test_issue_reproduction()
+    
+    # Test expected behavior
+    expected_behavior_works = test_expected_behavior()
+    
+    print("\n" + "=" * 50)
+    if issue_reproduced:
+        print("üêõ ISSUE REPRODUCED: Migration optimizer does not reduce multiple AlterField operations")
+        sys.exit(1)
+    else:
+        print("‚úÖ NO ISSUE: Migration optimizer works correctly")
+        sys.exit(0)
\ No newline at end of file
diff --git a/test_comprehensive.py b/test_comprehensive.py
new file mode 100644
index 0000000000..1f31f6fe3f
--- /dev/null
+++ b/test_comprehensive.py
@@ -0,0 +1,204 @@
+#!/usr/bin/env python3
+"""
+Comprehensive test for the AlterField optimization fix.
+Tests various edge cases and scenarios.
+"""
+
+import os
+import sys
+import django
+from django.conf import settings
+
+# Configure Django settings
+if not settings.configured:
+    settings.configure(
+        DEBUG=True,
+        DATABASES={
+            'default': {
+                'ENGINE': 'django.db.backends.sqlite3',
+                'NAME': ':memory:',
+            }
+        },
+        INSTALLED_APPS=[
+            'django.contrib.contenttypes',
+            'django.contrib.auth',
+        ],
+        SECRET_KEY='test-secret-key',
+    )
+    django.setup()
+
+from django.db import migrations, models
+from django.db.migrations.optimizer import MigrationOptimizer
+
+def test_multiple_alter_field_reduction():
+    """Test that multiple AlterField operations reduce to one."""
+    print("=== Test: Multiple AlterField Reduction ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=256, null=True)),
+        migrations.AlterField("book", "title", models.CharField(max_length=128, null=True)),
+        migrations.AlterField("book", "title", models.CharField(max_length=128, null=True, help_text="help")),
+        migrations.AlterField("book", "title", models.CharField(max_length=128, null=True, help_text="help", default=None)),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    success = len(result) == 1
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    if success:
+        final_field = result[0].field
+        print(f"Final field: max_length={final_field.max_length}, null={final_field.null}, help_text='{final_field.help_text}', default={final_field.default}")
+    
+    return success
+
+def test_different_fields_not_reduced():
+    """Test that AlterField operations on different fields are not reduced."""
+    print("\n=== Test: Different Fields Not Reduced ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=128)),
+        migrations.AlterField("book", "author", models.CharField(max_length=256)),
+        migrations.AlterField("book", "title", models.CharField(max_length=64)),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    # Should reduce the two title operations but keep the author operation
+    success = len(result) == 2
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    return success
+
+def test_different_models_not_reduced():
+    """Test that AlterField operations on different models are not reduced."""
+    print("\n=== Test: Different Models Not Reduced ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=128)),
+        migrations.AlterField("author", "name", models.CharField(max_length=256)),
+        migrations.AlterField("book", "title", models.CharField(max_length=64)),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    # Should reduce the two book.title operations but keep the author.name operation
+    success = len(result) == 2
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    return success
+
+def test_alter_field_with_remove_field():
+    """Test that AlterField followed by RemoveField reduces correctly."""
+    print("\n=== Test: AlterField with RemoveField ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=128)),
+        migrations.AlterField("book", "title", models.CharField(max_length=64)),
+        migrations.RemoveField("book", "title"),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    # Should reduce to just the RemoveField
+    success = len(result) == 1 and isinstance(result[0], migrations.RemoveField)
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    return success
+
+def test_alter_field_with_rename_field():
+    """Test that AlterField with RenameField works correctly."""
+    print("\n=== Test: AlterField with RenameField ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=128)),
+        migrations.AlterField("book", "title", models.CharField(max_length=64)),
+        migrations.RenameField("book", "title", "name"),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    # Should reduce to one AlterField (the last one) and the RenameField
+    success = len(result) == 2
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    return success
+
+def test_single_alter_field():
+    """Test that a single AlterField operation is not changed."""
+    print("\n=== Test: Single AlterField ===")
+    
+    operations = [
+        migrations.AlterField("book", "title", models.CharField(max_length=128)),
+    ]
+    
+    optimizer = MigrationOptimizer()
+    result = optimizer.optimize(operations, "books")
+    
+    print(f"Input: {len(operations)} operations")
+    print(f"Output: {len(result)} operations")
+    
+    success = len(result) == 1
+    print(f"Result: {'‚úÖ PASS' if success else '‚ùå FAIL'}")
+    
+    return success
+
+def run_all_tests():
+    """Run all comprehensive tests."""
+    print("Comprehensive AlterField Optimization Tests")
+    print("=" * 50)
+    
+    tests = [
+        test_multiple_alter_field_reduction,
+        test_different_fields_not_reduced,
+        test_different_models_not_reduced,
+        test_alter_field_with_remove_field,
+        test_alter_field_with_rename_field,
+        test_single_alter_field,
+    ]
+    
+    results = []
+    for test in tests:
+        try:
+            result = test()
+            results.append(result)
+        except Exception as e:
+            print(f"‚ùå ERROR in {test.__name__}: {e}")
+            results.append(False)
+    
+    print("\n" + "=" * 50)
+    print("Test Summary:")
+    passed = sum(results)
+    total = len(results)
+    print(f"Passed: {passed}/{total}")
+    
+    if passed == total:
+        print("üéâ All tests passed!")
+        return True
+    else:
+        print("‚ùå Some tests failed!")
+        return False
+
+if __name__ == "__main__":
+    success = run_all_tests()
+    sys.exit(0 if success else 1)
\ No newline at end of file
diff --git a/tests/migrations/test_optimizer.py b/tests/migrations/test_optimizer.py
index 6485009eb4..ee8f2aacfe 100644
--- a/tests/migrations/test_optimizer.py
+++ b/tests/migrations/test_optimizer.py
@@ -822,6 +822,32 @@ class OptimizerTests(SimpleTestCase):
             ],
         )
 
+    def test_alter_field_alter_field(self):
+        """
+        Multiple AlterField operations on the same field should reduce to the last one.
+        """
+        # Test with two operations first
+        self.assertOptimizesTo(
+            [
+                migrations.AlterField("Foo", "age", models.IntegerField()),
+                migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+            ],
+            [
+                migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+            ],
+        )
+        # Test with three operations - should reduce to the last one after multiple passes
+        self.assertOptimizesTo(
+            [
+                migrations.AlterField("Foo", "age", models.IntegerField()),
+                migrations.AlterField("Foo", "age", models.FloatField(default=2.4)),
+                migrations.AlterField("Foo", "age", models.FloatField(default=3.14, help_text="help")),
+            ],
+            [
+                migrations.AlterField("Foo", "age", models.FloatField(default=3.14, help_text="help")),
+            ],
+        )
+
     def _test_create_alter_foo_field(self, alter):
         """
         CreateModel, AlterFooTogether/AlterOrderWithRespectTo followed by an
--------
2026-01-06 15:40:41,310 - INFO - Using instance container image: docker.io/swebench/sweb.eval.x86_64.matplotlib_1776_matplotlib-26020:latest. Please make sure this image exists. Submit an issue on https://github.com/OpenHands/OpenHands if you run into any issues.
2026-01-06 15:40:41,311 - INFO - Resource mapping for princeton-nlp__SWE-bench_Lite-test not found.
2026-01-06 15:40:41,311 - INFO - Logging LLM completions for instance matplotlib__matplotlib-26020 to ./continuum32/princeton-nlp__SWE-bench_Lite-test/CodeActAgent/GLM-4.6-FP8_maxiter_135/llm_completions/matplotlib__matplotlib-26020
2026-01-06 15:40:41,311 - INFO - Config file not found: config.toml. Error: [Errno 2] No such file or directory: 'config.toml'
2026-01-06 15:40:41,311 - INFO - Config file not found: [Errno 2] No such file or directory: 'config.toml'. Toml values have not been applied.
