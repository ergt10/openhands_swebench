2026-01-06 15:30:18,871 - INFO - [LLM registry c09cae44-eae4-4b2c-b3e5-3e0425fee78b]: Registering service for agent
2026-01-06 15:30:18,932 - INFO - Building image: ghcr.io/openhands/runtime:oh_v1.0.0_zwrz4xqu9tkqhl0e_v008aov5t6vw3gr5
2026-01-06 15:43:00,832 - INFO - Image [ghcr.io/openhands/runtime:oh_v1.0.0_zwrz4xqu9tkqhl0e_v008aov5t6vw3gr5] build finished.
2026-01-06 15:43:00,838 - INFO - Re-tagged image [ghcr.io/openhands/runtime:oh_v1.0.0_zwrz4xqu9tkqhl0e_v008aov5t6vw3gr5] with more generic tag [oh_v1.0.0_zwrz4xqu9tkqhl0e]
2026-01-06 15:43:00,840 - INFO - Image ghcr.io/openhands/runtime with tags [oh_v1.0.0_zwrz4xqu9tkqhl0e_v008aov5t6vw3gr5, oh_v1.0.0_zwrz4xqu9tkqhl0e] built successfully
2026-01-06 15:43:00,892 - INFO - [runtime 47a5b314-0f68-41-162195a247b3719] Starting runtime with image: ghcr.io/openhands/runtime:oh_v1.0.0_zwrz4xqu9tkqhl0e_v008aov5t6vw3gr5
2026-01-06 15:43:01,038 - INFO - [runtime 47a5b314-0f68-41-162195a247b3719] Starting server with command: ['/openhands/micromamba/bin/micromamba', 'run', '-n', 'openhands', 'poetry', 'run', 'python', '-u', '-m', 'openhands.runtime.action_execution_server', '39082', '--working-dir', '/workspace', '--plugins', 'agent_skills', 'jupyter', '--username', 'root', '--user-id', '0', '--no-enable-browser']
2026-01-06 15:43:01,415 - INFO - [runtime 47a5b314-0f68-41-162195a247b3719] Container started: openhands-runtime-47a5b314-0f68-41-162195a247b3719. VSCode URL: None
2026-01-06 15:43:01,415 - INFO - [runtime 47a5b314-0f68-41-162195a247b3719] Waiting for client to become ready at http://localhost:39082...
2026-01-06 15:43:33,919 - INFO - [runtime 47a5b314-0f68-41-162195a247b3719] Runtime is ready.
2026-01-06 15:43:37,045 - INFO - Successfully configured git: name=openhands, email=openhands@all-hands.dev
2026-01-06 15:43:37,046 - INFO - ------------------------------
2026-01-06 15:43:37,047 - INFO - BEGIN Runtime Initialization Fn
2026-01-06 15:43:37,047 - INFO - ------------------------------
2026-01-06 15:43:37,047 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
echo 'export SWE_INSTANCE_ID=matplotlib__matplotlib-23987' >> ~/.bashrc && echo 'export PIP_CACHE_DIR=~/.cache/pip' >> ~/.bashrc && echo "alias git='git --no-pager'" >> ~/.bashrc && git config --global core.pager "" && git config --global diff.binary false
2026-01-06 15:43:37,668 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:43:37,668 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
export USER=$(whoami); echo USER=${USER} 
2026-01-06 15:43:38,289 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
USER=root
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:43:38,290 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
mkdir -p /swe_util/eval_data/instances
2026-01-06 15:43:38,910 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:43:38,916 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cat ~/.bashrc
2026-01-06 15:43:39,535 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
source /opt/miniconda3/etc/profile.d/conda.sh && conda activate testbed

. "/openhands/bin/env"
export PATH="/usr/bin:/bin:/usr/sbin:/sbin:/openhands/micromamba/bin:$PATH"
export PLAYWRIGHT_BROWSERS_PATH=/opt/playwright-browsers
eval "$(/openhands/micromamba/bin/micromamba shell hook --shell bash)"
micromamba activate openhands 2>/dev/null || true
export ENABLE_AUTO_LINT=true
export NO_CHANGE_TIMEOUT_SECONDS=30
export OPENHANDS_EVAL_INSTANCE_ID=matplotlib__matplotlib-23987
export OPENHANDS_EVAL_JOB_ID=310989074
export OPENHANDS_TIMING_DIR=./continuum32/princeton-nlp__SWE-bench_Lite-test/CodeActAgent/GLM-4.6-FP8_maxiter_135/timing
export SWE_INSTANCE_ID=matplotlib__matplotlib-23987
export PIP_CACHE_DIR=~/.cache/pip
alias git='git --no-pager'
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:43:39,535 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
source ~/.bashrc
2026-01-06 15:43:40,152 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace",
  "py_interpreter_path": "/openhands/micromamba/envs/openhands/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /openhands/micromamba/envs/openhands/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:43:40,153 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
source /swe_util/instance_swe_entry.sh
2026-01-06 15:43:43,284 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
WORKSPACE_NAME: matplotlib__matplotlib__3.6
[The command completed with exit code 0.]
[Current working directory: /workspace]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:43:43,284 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cd /workspace/matplotlib__matplotlib__3.6
2026-01-06 15:43:43,914 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace/matplotlib__matplotlib__3.6",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.6]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:43:43,914 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git reset --hard
2026-01-06 15:43:45,553 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace/matplotlib__matplotlib__3.6",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
Updating files: 100% (4357/4357), done.
HEAD is now at e98d8d085e Merge pull request #23980 from StefRe/DOC/tutorials-order
[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.6]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:43:45,555 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
for remote_name in $(git remote); do git remote remove "${remote_name}"; done
2026-01-06 15:43:46,174 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace/matplotlib__matplotlib__3.6",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.6]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:43:46,175 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
which python
2026-01-06 15:43:46,800 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace/matplotlib__matplotlib__3.6",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
/opt/miniconda3/envs/testbed/bin/python
[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.6]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:43:46,800 - INFO - ------------------------------
2026-01-06 15:43:46,801 - INFO - END Runtime Initialization Fn
2026-01-06 15:43:46,801 - INFO - ------------------------------
2026-01-06 15:43:46,804 - INFO - [LLM registry a054b70c-49a9-498a-97d5-76fb6120a092]: Registering service for agent
2026-01-06 15:43:46,820 - INFO - [runtime 47a5b314-0f68-41-162195a247b3719] Selected repo: None, loading microagents from /workspace/.openhands/microagents (inside runtime)
2026-01-06 15:43:46,822 - INFO - [runtime 47a5b314-0f68-41-162195a247b3719] Attempting to list files in repository microagents directory: /workspace/.openhands/microagents
2026-01-06 15:43:46,824 - INFO - Loading user workspace microagents: []
2026-01-06 15:43:46,825 - INFO - AgentController 47a5b314-0f68-41-162195a247b3719 - created new state. start_id: 0
2026-01-06 15:43:46,833 - INFO - [Agent Controller 47a5b314-0f68-41-162195a247b3719] Setting agent(CodeActAgent) state from AgentState.LOADING to AgentState.RUNNING
2026-01-06 15:43:46,836 - INFO - Saved conversation stats
2026-01-06 15:54:43,750 - INFO - [Agent Controller 47a5b314-0f68-41-162195a247b3719] Setting agent(CodeActAgent) state from AgentState.RUNNING to AgentState.FINISHED
2026-01-06 15:54:43,752 - INFO - Saved conversation stats
2026-01-06 15:54:43,788 - INFO - ------------------------------
2026-01-06 15:54:43,788 - INFO - BEGIN Runtime Completion Fn
2026-01-06 15:54:43,788 - INFO - ------------------------------
2026-01-06 15:54:43,789 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
cd /workspace/matplotlib__matplotlib__3.6
2026-01-06 15:54:44,411 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace/matplotlib__matplotlib__3.6",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.6]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:54:44,411 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git config --global core.pager ""
2026-01-06 15:54:45,031 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace/matplotlib__matplotlib__3.6",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.6]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:54:45,031 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
find . -type d -name .git -not -path "./.git"
2026-01-06 15:54:45,650 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace/matplotlib__matplotlib__3.6",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.6]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:54:45,650 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git add -A
2026-01-06 15:54:46,274 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace/matplotlib__matplotlib__3.6",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.6]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:54:46,275 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
for file in $(git status --porcelain | grep -E "^(M| M|\?\?|A| A)" | cut -c4-); do
        if [ -f "$file" ] && (file "$file" | grep -q "executable" || git check-attr binary "$file" | grep -q "binary: set"); then
            git rm -f "$file" 2>/dev/null || rm -f "$file"
            echo "Removed: $file"
        fi
    done
2026-01-06 15:54:46,907 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace/matplotlib__matplotlib__3.6",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--
bash: file: command not found
bash: file: command not found
bash: file: command not found
[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.6]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:54:46,907 - INFO - **CmdRunAction (source=None, is_input=False)**
COMMAND:
git diff --no-color --cached e98d8d085e8f53ec0467422b326f7738a2dd695e > patch.diff
2026-01-06 15:54:47,529 - INFO - **CmdOutputObservation (source=None, exit code=0, metadata={
  "exit_code": 0,
  "pid": -1,
  "username": "root",
  "hostname": "3e3933c33e00",
  "working_dir": "/workspace/matplotlib__matplotlib__3.6",
  "py_interpreter_path": "/opt/miniconda3/envs/testbed/bin/python",
  "prefix": "",
  "suffix": "\n[The command completed with exit code 0.]"
})**
--BEGIN AGENT OBSERVATION--

[The command completed with exit code 0.]
[Current working directory: /workspace/matplotlib__matplotlib__3.6]
[Python interpreter: /opt/miniconda3/envs/testbed/bin/python]
[Command finished with exit code 0]
--END AGENT OBSERVATION--
2026-01-06 15:54:47,529 - INFO - FileReadAction(path='patch.diff', start=0, end=-1, thought='', action=<ActionType.READ: 'read'>, security_risk=<ActionSecurityRisk.UNKNOWN: -1>, impl_source=<FileReadSource.DEFAULT: 'default'>, view_range=None)
2026-01-06 15:54:47,532 - INFO - [Read from /workspace/matplotlib__matplotlib__3.6/patch.diff is successful.]
diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py
index 5bbb786984..c1368b6dfc 100644
--- a/lib/matplotlib/figure.py
+++ b/lib/matplotlib/figure.py
@@ -2426,9 +2426,12 @@ class Figure(FigureBase):
             if isinstance(tight_layout, dict):
                 self.get_layout_engine().set(**tight_layout)
         elif constrained_layout is not None:
-            self.set_layout_engine(layout='constrained')
-            if isinstance(constrained_layout, dict):
-                self.get_layout_engine().set(**constrained_layout)
+            if constrained_layout:
+                self.set_layout_engine(layout='constrained')
+                if isinstance(constrained_layout, dict):
+                    self.get_layout_engine().set(**constrained_layout)
+            else:
+                self.set_layout_engine(layout='none')
         else:
             # everything is None, so use default:
             self.set_layout_engine(layout=layout)
diff --git a/test_edge_cases.py b/test_edge_cases.py
new file mode 100644
index 0000000000..81d0e594fe
--- /dev/null
+++ b/test_edge_cases.py
@@ -0,0 +1,141 @@
+#!/usr/bin/env python3
+"""
+Edge case tests for the constrained layout fix.
+"""
+
+import matplotlib.pyplot as plt
+import numpy as np
+import warnings
+import sys
+
+def test_constrained_layout_dict():
+    """Test constrained_layout as dict (should be treated as True)."""
+    print("Testing constrained_layout as dict...")
+    
+    with warnings.catch_warnings(record=True) as w:
+        warnings.simplefilter("always")
+        
+        # Create figure with constrained_layout as dict
+        fig, ax = plt.subplots(1, 2, figsize=(8, 2), 
+                               constrained_layout={'h_pad': 0.1, 'w_pad': 0.1})
+        
+        # This should generate a warning since constrained_layout is True
+        plt.subplots_adjust(wspace=0)
+        
+        layout_warnings = [warning for warning in w 
+                          if "layout engine" in str(warning.message)]
+        
+        plt.close(fig)
+        
+        if layout_warnings:
+            print("✅ PASS: Warning generated for dict (as expected)")
+            return True
+        else:
+            print("❌ FAIL: No warning generated for dict")
+            return False
+
+def test_bbox_inches_tight():
+    """Test bbox_inches='tight' with constrained_layout=False."""
+    print("\nTesting bbox_inches='tight' with constrained_layout=False...")
+    
+    with warnings.catch_warnings(record=True) as w:
+        warnings.simplefilter("always")
+        
+        # Create figure with constrained_layout=False
+        fig, ax = plt.subplots(1, 2, figsize=(8, 2), constrained_layout=False)
+        
+        # Plot some data
+        a = np.linspace(0, 2*np.pi, 100)
+        b = np.sin(a)
+        c = np.cos(a)
+        ax[0].plot(a, b)
+        ax[1].plot(a, c)
+        
+        # This should NOT generate a warning
+        plt.savefig('/tmp/test_bbox.png', bbox_inches='tight')
+        
+        layout_warnings = [warning for warning in w 
+                          if "layout engine" in str(warning.message)]
+        
+        plt.close(fig)
+        
+        if layout_warnings:
+            print("❌ FAIL: Warning generated when it shouldn't be:")
+            for warning in layout_warnings:
+                print(f"   {warning.message}")
+            return False
+        else:
+            print("✅ PASS: No warning generated (as expected)")
+            return True
+
+def test_mixed_parameters():
+    """Test various parameter combinations."""
+    print("\nTesting mixed parameter combinations...")
+    
+    test_cases = [
+        # (constrained_layout, tight_layout, expected_warning, description)
+        (False, None, False, "constrained_layout=False, tight_layout=None"),
+        (True, None, True, "constrained_layout=True, tight_layout=None"),
+        (None, False, False, "constrained_layout=None, tight_layout=False"),
+        (None, True, False, "constrained_layout=None, tight_layout=True (TightLayoutEngine is compatible)"),
+    ]
+    
+    all_passed = True
+    
+    for constrained, tight, should_warn, description in test_cases:
+        print(f"  Testing: {description}")
+        
+        with warnings.catch_warnings(record=True) as w:
+            warnings.simplefilter("always")
+            
+            try:
+                fig, ax = plt.subplots(1, 2, figsize=(8, 2), 
+                                       constrained_layout=constrained,
+                                       tight_layout=tight)
+                
+                plt.subplots_adjust(wspace=0)
+                
+                layout_warnings = [warning for warning in w 
+                                  if "layout engine" in str(warning.message)]
+                
+                plt.close(fig)
+                
+                if should_warn and not layout_warnings:
+                    print(f"    ❌ FAIL: Expected warning but none generated")
+                    all_passed = False
+                elif not should_warn and layout_warnings:
+                    print(f"    ❌ FAIL: Unexpected warning generated")
+                    all_passed = False
+                else:
+                    print(f"    ✅ PASS")
+                    
+            except Exception as e:
+                print(f"    ❌ FAIL: Exception occurred: {e}")
+                all_passed = False
+    
+    return all_passed
+
+def main():
+    """Run all edge case tests."""
+    print("=" * 60)
+    print("EDGE CASE TESTS FOR CONSTRAINED LAYOUT FIX")
+    print("=" * 60)
+    
+    results = []
+    results.append(test_constrained_layout_dict())
+    results.append(test_bbox_inches_tight())
+    results.append(test_mixed_parameters())
+    
+    print("\n" + "=" * 60)
+    print("EDGE CASE SUMMARY:")
+    print("=" * 60)
+    
+    if all(results):
+        print("✅ ALL EDGE CASE TESTS PASSED")
+        return 0
+    else:
+        print("❌ SOME EDGE CASE TESTS FAILED")
+        return 1
+
+if __name__ == "__main__":
+    sys.exit(main())
diff --git a/test_reproduction.py b/test_reproduction.py
new file mode 100644
index 0000000000..96cecbbd7a
--- /dev/null
+++ b/test_reproduction.py
@@ -0,0 +1,145 @@
+#!/usr/bin/env python3
+"""
+Reproduction script for the constrained layout warning issue.
+
+This script reproduces the bug where a UserWarning is generated when using
+subplots_adjust even when constrained_layout=False is explicitly set.
+"""
+
+import matplotlib.pyplot as plt
+import numpy as np
+import warnings
+import sys
+
+def test_constrained_layout_false_warning():
+    """Test that constrained_layout=False doesn't generate warning."""
+    print("Testing constrained_layout=False with subplots_adjust...")
+    
+    # Capture warnings
+    with warnings.catch_warnings(record=True) as w:
+        warnings.simplefilter("always")
+        
+        # Create figure with constrained_layout=False explicitly
+        fig, ax = plt.subplots(1, 2, figsize=(8, 2), constrained_layout=False)
+        
+        # Plot some data
+        a = np.linspace(0, 2*np.pi, 100)
+        b = np.sin(a)
+        c = np.cos(a)
+        ax[0].plot(a, b)
+        ax[1].plot(a, c)
+        
+        # This should NOT generate a warning
+        plt.subplots_adjust(wspace=0)
+        
+        # Check if any warnings were generated
+        layout_warnings = [warning for warning in w 
+                          if "layout engine" in str(warning.message)]
+        
+        plt.close(fig)
+        
+        if layout_warnings:
+            print("❌ FAIL: Warning generated when it shouldn't be:")
+            for warning in layout_warnings:
+                print(f"   {warning.message}")
+            return False
+        else:
+            print("✅ PASS: No warning generated (as expected)")
+            return True
+
+def test_constrained_layout_true_warning():
+    """Test that constrained_layout=True does generate warning."""
+    print("\nTesting constrained_layout=True with subplots_adjust...")
+    
+    # Capture warnings
+    with warnings.catch_warnings(record=True) as w:
+        warnings.simplefilter("always")
+        
+        # Create figure with constrained_layout=True explicitly
+        fig, ax = plt.subplots(1, 2, figsize=(8, 2), constrained_layout=True)
+        
+        # Plot some data
+        a = np.linspace(0, 2*np.pi, 100)
+        b = np.sin(a)
+        c = np.cos(a)
+        ax[0].plot(a, b)
+        ax[1].plot(a, c)
+        
+        # This SHOULD generate a warning
+        plt.subplots_adjust(wspace=0)
+        
+        # Check if any warnings were generated
+        layout_warnings = [warning for warning in w 
+                          if "layout engine" in str(warning.message)]
+        
+        plt.close(fig)
+        
+        if layout_warnings:
+            print("✅ PASS: Warning generated (as expected)")
+            for warning in layout_warnings:
+                print(f"   {warning.message}")
+            return True
+        else:
+            print("❌ FAIL: No warning generated when it should be")
+            return False
+
+def test_no_constrained_layout():
+    """Test that no constrained_layout parameter doesn't generate warning."""
+    print("\nTesting no constrained_layout parameter with subplots_adjust...")
+    
+    # Capture warnings
+    with warnings.catch_warnings(record=True) as w:
+        warnings.simplefilter("always")
+        
+        # Create figure without constrained_layout parameter
+        fig, ax = plt.subplots(1, 2, figsize=(8, 2))
+        
+        # Plot some data
+        a = np.linspace(0, 2*np.pi, 100)
+        b = np.sin(a)
+        c = np.cos(a)
+        ax[0].plot(a, b)
+        ax[1].plot(a, c)
+        
+        # This should NOT generate a warning
+        plt.subplots_adjust(wspace=0)
+        
+        # Check if any warnings were generated
+        layout_warnings = [warning for warning in w 
+                          if "layout engine" in str(warning.message)]
+        
+        plt.close(fig)
+        
+        if layout_warnings:
+            print("❌ FAIL: Warning generated when it shouldn't be:")
+            for warning in layout_warnings:
+                print(f"   {warning.message}")
+            return False
+        else:
+            print("✅ PASS: No warning generated (as expected)")
+            return True
+
+def main():
+    """Run all tests and report results."""
+    print("=" * 60)
+    print("REPRODUCTION SCRIPT FOR CONSTRAINED LAYOUT WARNING BUG")
+    print("=" * 60)
+    
+    results = []
+    results.append(test_constrained_layout_false_warning())
+    results.append(test_constrained_layout_true_warning())
+    results.append(test_no_constrained_layout())
+    
+    print("\n" + "=" * 60)
+    print("SUMMARY:")
+    print("=" * 60)
+    
+    if all(results):
+        print("✅ ALL TESTS PASSED")
+        return 0
+    else:
+        print("❌ SOME TESTS FAILED")
+        return 1
+
+if __name__ == "__main__":
+    sys.exit(main())

2026-01-06 15:54:47,533 - INFO - ------------------------------
2026-01-06 15:54:47,533 - INFO - END Runtime Completion Fn
2026-01-06 15:54:47,533 - INFO - ------------------------------
2026-01-06 15:54:47,534 - INFO - Got git diff for instance matplotlib__matplotlib-23987:
--------
diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py
index 5bbb786984..c1368b6dfc 100644
--- a/lib/matplotlib/figure.py
+++ b/lib/matplotlib/figure.py
@@ -2426,9 +2426,12 @@ class Figure(FigureBase):
             if isinstance(tight_layout, dict):
                 self.get_layout_engine().set(**tight_layout)
         elif constrained_layout is not None:
-            self.set_layout_engine(layout='constrained')
-            if isinstance(constrained_layout, dict):
-                self.get_layout_engine().set(**constrained_layout)
+            if constrained_layout:
+                self.set_layout_engine(layout='constrained')
+                if isinstance(constrained_layout, dict):
+                    self.get_layout_engine().set(**constrained_layout)
+            else:
+                self.set_layout_engine(layout='none')
         else:
             # everything is None, so use default:
             self.set_layout_engine(layout=layout)
diff --git a/test_edge_cases.py b/test_edge_cases.py
new file mode 100644
index 0000000000..81d0e594fe
--- /dev/null
+++ b/test_edge_cases.py
@@ -0,0 +1,141 @@
+#!/usr/bin/env python3
+"""
+Edge case tests for the constrained layout fix.
+"""
+
+import matplotlib.pyplot as plt
+import numpy as np
+import warnings
+import sys
+
+def test_constrained_layout_dict():
+    """Test constrained_layout as dict (should be treated as True)."""
+    print("Testing constrained_layout as dict...")
+    
+    with warnings.catch_warnings(record=True) as w:
+        warnings.simplefilter("always")
+        
+        # Create figure with constrained_layout as dict
+        fig, ax = plt.subplots(1, 2, figsize=(8, 2), 
+                               constrained_layout={'h_pad': 0.1, 'w_pad': 0.1})
+        
+        # This should generate a warning since constrained_layout is True
+        plt.subplots_adjust(wspace=0)
+        
+        layout_warnings = [warning for warning in w 
+                          if "layout engine" in str(warning.message)]
+        
+        plt.close(fig)
+        
+        if layout_warnings:
+            print("✅ PASS: Warning generated for dict (as expected)")
+            return True
+        else:
+            print("❌ FAIL: No warning generated for dict")
+            return False
+
+def test_bbox_inches_tight():
+    """Test bbox_inches='tight' with constrained_layout=False."""
+    print("\nTesting bbox_inches='tight' with constrained_layout=False...")
+    
+    with warnings.catch_warnings(record=True) as w:
+        warnings.simplefilter("always")
+        
+        # Create figure with constrained_layout=False
+        fig, ax = plt.subplots(1, 2, figsize=(8, 2), constrained_layout=False)
+        
+        # Plot some data
+        a = np.linspace(0, 2*np.pi, 100)
+        b = np.sin(a)
+        c = np.cos(a)
+        ax[0].plot(a, b)
+        ax[1].plot(a, c)
+        
+        # This should NOT generate a warning
+        plt.savefig('/tmp/test_bbox.png', bbox_inches='tight')
+        
+        layout_warnings = [warning for warning in w 
+                          if "layout engine" in str(warning.message)]
+        
+        plt.close(fig)
+        
+        if layout_warnings:
+            print("❌ FAIL: Warning generated when it shouldn't be:")
+            for warning in layout_warnings:
+                print(f"   {warning.message}")
+            return False
+        else:
+            print("✅ PASS: No warning generated (as expected)")
+            return True
+
+def test_mixed_parameters():
+    """Test various parameter combinations."""
+    print("\nTesting mixed parameter combinations...")
+    
+    test_cases = [
+        # (constrained_layout, tight_layout, expected_warning, description)
+        (False, None, False, "constrained_layout=False, tight_layout=None"),
+        (True, None, True, "constrained_layout=True, tight_layout=None"),
+        (None, False, False, "constrained_layout=None, tight_layout=False"),
+        (None, True, False, "constrained_layout=None, tight_layout=True (TightLayoutEngine is compatible)"),
+    ]
+    
+    all_passed = True
+    
+    for constrained, tight, should_warn, description in test_cases:
+        print(f"  Testing: {description}")
+        
+        with warnings.catch_warnings(record=True) as w:
+            warnings.simplefilter("always")
+            
+            try:
+                fig, ax = plt.subplots(1, 2, figsize=(8, 2), 
+                                       constrained_layout=constrained,
+                                       tight_layout=tight)
+                
+                plt.subplots_adjust(wspace=0)
+                
+                layout_warnings = [warning for warning in w 
+                                  if "layout engine" in str(warning.message)]
+                
+                plt.close(fig)
+                
+                if should_warn and not layout_warnings:
+                    print(f"    ❌ FAIL: Expected warning but none generated")
+                    all_passed = False
+                elif not should_warn and layout_warnings:
+                    print(f"    ❌ FAIL: Unexpected warning generated")
+                    all_passed = False
+                else:
+                    print(f"    ✅ PASS")
+                    
+            except Exception as e:
+                print(f"    ❌ FAIL: Exception occurred: {e}")
+                all_passed = False
+    
+    return all_passed
+
+def main():
+    """Run all edge case tests."""
+    print("=" * 60)
+    print("EDGE CASE TESTS FOR CONSTRAINED LAYOUT FIX")
+    print("=" * 60)
+    
+    results = []
+    results.append(test_constrained_layout_dict())
+    results.append(test_bbox_inches_tight())
+    results.append(test_mixed_parameters())
+    
+    print("\n" + "=" * 60)
+    print("EDGE CASE SUMMARY:")
+    print("=" * 60)
+    
+    if all(results):
+        print("✅ ALL EDGE CASE TESTS PASSED")
+        return 0
+    else:
+        print("❌ SOME EDGE CASE TESTS FAILED")
+        return 1
+
+if __name__ == "__main__":
+    sys.exit(main())
diff --git a/test_reproduction.py b/test_reproduction.py
new file mode 100644
index 0000000000..96cecbbd7a
--- /dev/null
+++ b/test_reproduction.py
@@ -0,0 +1,145 @@
+#!/usr/bin/env python3
+"""
+Reproduction script for the constrained layout warning issue.
+
+This script reproduces the bug where a UserWarning is generated when using
+subplots_adjust even when constrained_layout=False is explicitly set.
+"""
+
+import matplotlib.pyplot as plt
+import numpy as np
+import warnings
+import sys
+
+def test_constrained_layout_false_warning():
+    """Test that constrained_layout=False doesn't generate warning."""
+    print("Testing constrained_layout=False with subplots_adjust...")
+    
+    # Capture warnings
+    with warnings.catch_warnings(record=True) as w:
+        warnings.simplefilter("always")
+        
+        # Create figure with constrained_layout=False explicitly
+        fig, ax = plt.subplots(1, 2, figsize=(8, 2), constrained_layout=False)
+        
+        # Plot some data
+        a = np.linspace(0, 2*np.pi, 100)
+        b = np.sin(a)
+        c = np.cos(a)
+        ax[0].plot(a, b)
+        ax[1].plot(a, c)
+        
+        # This should NOT generate a warning
+        plt.subplots_adjust(wspace=0)
+        
+        # Check if any warnings were generated
+        layout_warnings = [warning for warning in w 
+                          if "layout engine" in str(warning.message)]
+        
+        plt.close(fig)
+        
+        if layout_warnings:
+            print("❌ FAIL: Warning generated when it shouldn't be:")
+            for warning in layout_warnings:
+                print(f"   {warning.message}")
+            return False
+        else:
+            print("✅ PASS: No warning generated (as expected)")
+            return True
+
+def test_constrained_layout_true_warning():
+    """Test that constrained_layout=True does generate warning."""
+    print("\nTesting constrained_layout=True with subplots_adjust...")
+    
+    # Capture warnings
+    with warnings.catch_warnings(record=True) as w:
+        warnings.simplefilter("always")
+        
+        # Create figure with constrained_layout=True explicitly
+        fig, ax = plt.subplots(1, 2, figsize=(8, 2), constrained_layout=True)
+        
+        # Plot some data
+        a = np.linspace(0, 2*np.pi, 100)
+        b = np.sin(a)
+        c = np.cos(a)
+        ax[0].plot(a, b)
+        ax[1].plot(a, c)
+        
+        # This SHOULD generate a warning
+        plt.subplots_adjust(wspace=0)
+        
+        # Check if any warnings were generated
+        layout_warnings = [warning for warning in w 
+                          if "layout engine" in str(warning.message)]
+        
+        plt.close(fig)
+        
+        if layout_warnings:
+            print("✅ PASS: Warning generated (as expected)")
+            for warning in layout_warnings:
+                print(f"   {warning.message}")
+            return True
+        else:
+            print("❌ FAIL: No warning generated when it should be")
+            return False
+
+def test_no_constrained_layout():
+    """Test that no constrained_layout parameter doesn't generate warning."""
+    print("\nTesting no constrained_layout parameter with subplots_adjust...")
+    
+    # Capture warnings
+    with warnings.catch_warnings(record=True) as w:
+        warnings.simplefilter("always")
+        
+        # Create figure without constrained_layout parameter
+        fig, ax = plt.subplots(1, 2, figsize=(8, 2))
+        
+        # Plot some data
+        a = np.linspace(0, 2*np.pi, 100)
+        b = np.sin(a)
+        c = np.cos(a)
+        ax[0].plot(a, b)
+        ax[1].plot(a, c)
+        
+        # This should NOT generate a warning
+        plt.subplots_adjust(wspace=0)
+        
+        # Check if any warnings were generated
+        layout_warnings = [warning for warning in w 
+                          if "layout engine" in str(warning.message)]
+        
+        plt.close(fig)
+        
+        if layout_warnings:
+            print("❌ FAIL: Warning generated when it shouldn't be:")
+            for warning in layout_warnings:
+                print(f"   {warning.message}")
+            return False
+        else:
+            print("✅ PASS: No warning generated (as expected)")
+            return True
+
+def main():
+    """Run all tests and report results."""
+    print("=" * 60)
+    print("REPRODUCTION SCRIPT FOR CONSTRAINED LAYOUT WARNING BUG")
+    print("=" * 60)
+    
+    results = []
+    results.append(test_constrained_layout_false_warning())
+    results.append(test_constrained_layout_true_warning())
+    results.append(test_no_constrained_layout())
+    
+    print("\n" + "=" * 60)
+    print("SUMMARY:")
+    print("=" * 60)
+    
+    if all(results):
+        print("✅ ALL TESTS PASSED")
+        return 0
+    else:
+        print("❌ SOME TESTS FAILED")
+        return 1
+
+if __name__ == "__main__":
+    sys.exit(main())
--------
2026-01-06 15:54:53,454 - INFO - Using instance container image: docker.io/swebench/sweb.eval.x86_64.pylint-dev_1776_pylint-7114:latest. Please make sure this image exists. Submit an issue on https://github.com/OpenHands/OpenHands if you run into any issues.
2026-01-06 15:54:53,454 - INFO - Resource mapping for princeton-nlp__SWE-bench_Lite-test not found.
2026-01-06 15:54:53,454 - INFO - Logging LLM completions for instance pylint-dev__pylint-7114 to ./continuum32/princeton-nlp__SWE-bench_Lite-test/CodeActAgent/GLM-4.6-FP8_maxiter_135/llm_completions/pylint-dev__pylint-7114
2026-01-06 15:54:53,455 - INFO - Config file not found: config.toml. Error: [Errno 2] No such file or directory: 'config.toml'
2026-01-06 15:54:53,455 - INFO - Config file not found: [Errno 2] No such file or directory: 'config.toml'. Toml values have not been applied.
